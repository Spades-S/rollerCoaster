{"version":3,"sources":["../../../../src/common/controller/error.js"],"names":["Object","defineProperty","exports","value","_defineProperty2","require","_defineProperty3","_interopRequireDefault","_getPrototypeOf","_getPrototypeOf2","_classCallCheck2","_classCallCheck3","_createClass2","_createClass3","_possibleConstructorReturn2","_possibleConstructorReturn3","_inherits2","_inherits3","obj","__esModule","default","_class","_think$controller$bas","__proto__","apply","arguments","key","displayError","status","_this2","think","env","http","error","errorConfig","config","message","isJsonp","_jsonp","jsonp","msg","isAjax","fail","module","mode","mode_module","file","options","extend","type","file_depr","fetch","then","content","replace","content_type","end","_400Action","_403Action","_404Action","_500Action","_503Action","controller","base"],"mappings":"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","file":"error.js","sourcesContent":["'use strict';\n/**\n * error controller\n */\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _defineProperty2 = require('babel-runtime/helpers/defineProperty');\n\nvar _defineProperty3 = _interopRequireDefault(_defineProperty2);\n\nvar _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar _class = function (_think$controller$bas) {\n  (0, _inherits3.default)(_class, _think$controller$bas);\n\n  function _class() {\n    (0, _classCallCheck3.default)(this, _class);\n    return (0, _possibleConstructorReturn3.default)(this, (_class.__proto__ || (0, _getPrototypeOf2.default)(_class)).apply(this, arguments));\n  }\n\n  (0, _createClass3.default)(_class, [{\n    key: 'displayError',\n\n    /**\n     * display error page\n     * @param  {Number} status []\n     * @return {Promise}        []\n     */\n    value: function displayError(status) {\n      var _this2 = this;\n\n      //hide error message on production env\n      if (think.env === 'production') {\n        this.http.error = null;\n      }\n\n      var errorConfig = this.config('error');\n      var message = this.http.error && this.http.error.message || '';\n      if (this.isJsonp()) {\n        var _jsonp;\n\n        return this.jsonp((_jsonp = {}, (0, _defineProperty3.default)(_jsonp, errorConfig.key, status), (0, _defineProperty3.default)(_jsonp, errorConfig.msg, message), _jsonp));\n      } else if (this.isAjax()) {\n        return this.fail(status, message);\n      }\n\n      var module = 'common';\n      if (think.mode !== think.mode_module) {\n        module = this.config('default_module');\n      }\n      var file = module + '/error/' + status + '.html';\n      var options = this.config('tpl');\n      options = think.extend({}, options, { type: 'base', file_depr: '_' });\n      this.fetch(file, {}, options).then(function (content) {\n        content = content.replace('ERROR_MESSAGE', message);\n        _this2.type(options.content_type);\n        _this2.end(content);\n      });\n    }\n    /**\n     * Bad Request \n     * @return {Promise} []\n     */\n\n  }, {\n    key: '_400Action',\n    value: function _400Action() {\n      return this.displayError(400);\n    }\n    /**\n     * Forbidden \n     * @return {Promise} []\n     */\n\n  }, {\n    key: '_403Action',\n    value: function _403Action() {\n      return this.displayError(403);\n    }\n    /**\n     * Not Found \n     * @return {Promise}      []\n     */\n\n  }, {\n    key: '_404Action',\n    value: function _404Action() {\n      return this.displayError(404);\n    }\n    /**\n     * Internal Server Error\n     * @return {Promise}      []\n     */\n\n  }, {\n    key: '_500Action',\n    value: function _500Action() {\n      return this.displayError(500);\n    }\n    /**\n     * Service Unavailable\n     * @return {Promise}      []\n     */\n\n  }, {\n    key: '_503Action',\n    value: function _503Action() {\n      return this.displayError(503);\n    }\n  }]);\n  return _class;\n}(think.controller.base);\n\nexports.default = _class;\n//# sourceMappingURL=error.js.map"]}