{"version":3,"sources":["../../../../src/home/controller/article.js"],"names":["articleId","get","checkLogin","console","log","session","readList","indexOf","parseInt","push","assign","display","isPost","userid","post","articleid","timestamp","content","userModel","model","getAvatarInfoByUserId","authorInfo","authorAvatar","avatar","authorName","nickname","articleModel","addComment","data","success","greyList","invisibleList","currentPage","perPageNum","getPerPageItems","forEach","el","id","readClass","getArticleItemByid","getColByArticleId","authoridRowData","col","getRelativeArticlesByCol","relativeArticles","length","slice","likes","uid","cookie","updateLikesByArticleId","art_lines","updateLikes","likecookie","newlikearray","JSON","parse","getLikes","rowdata","commentModel","getCommentByPostId","comment","commentLength","splice","commentContent"],"mappings":"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","file":"article.js","sourcesContent":["'use strict'\nimport base from './base.js';\nexport default class extends base {\n    async detailAction() {\n        let articleId = this.get('articleid');\n\n        if (checkLogin(this)) {\n            console.log('Login checked!');\n\n            // to be finished\n\n        } else {\n        \tlet readList = (await this.session('readList')) || []\n\t        if (readList.indexOf(parseInt(articleId)) < 0) {\n\t\t        readList.push(parseInt(articleId));\n\t        }\n\t        await this.session('readList', readList)\n        }\n        this.assign('articleid', articleId);\n        return this.display('article/detail.html');\n    }\n\n    async addcommentAction() {\n        if (this.isPost()) {\n            let userid = this.post(\"userid\");\n            let articleid = this.post('articleid');\n            let timestamp = this.post('timestamp');\n            let content = this.post('content');\n            let userModel = this.model('user');\n            let authorInfo = await userModel.getAvatarInfoByUserId(parseInt(userid));\n            let authorAvatar = authorInfo[0].avatar;\n            let authorName = authorInfo[0].nickname;\n            let articleModel = this.model('comment');\n            let data = await articleModel.addComment(parseInt(userid), parseInt(articleid), authorAvatar, authorName, content, parseInt(timestamp));\n            return this.success(data);\n        }\n    }\n\n    async refresharticlesAction() {\n        let greyList = [];\n        let invisibleList = [];\n        let readList = await this.session('readList')\n        if (readList) {\n         /* if (readList.length > 5) { */\n\t\t        greyList = readList // .splice(-5, 5);\n\t\t        // console.log('greyList', greyList)\n\t\t        invisibleList = readList;\n         /* } else {\n                greyList = readList;\n            } */\n        }\n        let currentPage = this.get('currentPage');\n        let perPageNum = this.get('perPageNums');\n        let articleModel = this.model('article');\n        let data = await articleModel.getPerPageItems(perPageNum, currentPage, invisibleList);\n        data.data.forEach(el => {\n        \tif (greyList.indexOf(el.id) >= 0) {\n        \t\tel.readClass = \"readed\"\n\t        } else {\n\t\t        el.readClass = \"\"\n\t        }\n        })\n        return this.success(data);\n    }\n\n    async getarticlebyarticleidAction() {\n        let articleid = this.get('articleid');\n        let articleModel = this.model('article');\n        let data = await articleModel.getArticleItemByid(articleid);\n        return this.success(data);\n\n    }\n\n    async getrelativearticleAction() {\n        let articleid = this.get('articleid');\n        let articleModel = this.model('article');\n        let authoridRowData = await articleModel.getColByArticleId(articleid);\n        let col = authoridRowData[0].col;\n        let relativeArticles = await articleModel.getRelativeArticlesByCol(col, articleid);\n        if (relativeArticles.length >= 2) {\n            relativeArticles = relativeArticles.slice(0, 2);\n        }\n        return this.success(relativeArticles);\n\n    }\n\n    async refreshlikesAction() {\n        let likes = this.post('likes');\n        let uid = this.cookie('uid');\n        let articleid = parseInt(this.post('articleid'));\n        let articleModel = this.model('article');\n        let art_lines = await articleModel.updateLikesByArticleId(articleid, likes);\n        if (uid) {\n            let userModel = this.model('user');\n            let data = await userModel.updateLikes(articleid, uid);\n            return this.success(data);\n        } else {\n            let likecookie = this.cookie('likecookie');\n            let newlikearray = [];\n            if (likecookie) {\n                newlikearray = JSON.parse(likecookie);\n                if (newlikearray.indexOf(articleid) < 0) {\n                    newlikearray.push(articleid);\n                }\n            } else {\n                newlikearray.push(articleid);\n            }\n            this.cookie('likecookie', JSON.stringify(newlikearray));\n            return this.success();\n        }\n\n    }\n\n    async getlikestatusAction() {\n\n        let uid = this.cookie('uid');\n        let articleid = parseInt(this.get('articleid'));\n        let likes = [];\n        if (uid) {\n            let userModel = this.model('user');\n            let rowdata = await userModel.getLikes(uid);\n            likes = JSON.parse(rowdata[0].likes);\n        } else {\n            if (this.cookie('likecookie')) {\n                likes = JSON.parse(this.cookie('likecookie'));\n            }\n        }\n\n        let data;\n        if (likes.indexOf(articleid) >= 0) {\n            data = true;\n        } else {\n            data = false;\n        }\n        return this.success(data);\n    }\n\n    async getcommentbyarticleidAction() {\n        let articleid = this.get('articleid');\n        let commentModel = this.model('comment');\n        let comment = await commentModel.getCommentByPostId(parseInt(articleid));\n        let commentLength = comment.length;\n        if (commentLength >= 2) {\n            comment = comment.splice(0, 2)\n        }\n        return this.success({commentLength: commentLength, commentContent: comment});\n    }\n}"]}