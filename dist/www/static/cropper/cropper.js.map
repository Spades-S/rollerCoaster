{"version":3,"sources":["../../../../www/static/cropper/cropper.js"],"names":["global","factory","exports","module","define","amd","Cropper","DEFAULTS","viewMode","dragMode","aspectRatio","NaN","data","preview","responsive","restore","checkCrossOrigin","checkOrientation","modal","guides","center","highlight","background","autoCrop","autoCropArea","movable","rotatable","scalable","zoomable","zoomOnTouch","zoomOnWheel","wheelZoomRatio","cropBoxMovable","cropBoxResizable","toggleDragModeOnDblclick","minCanvasWidth","minCanvasHeight","minCropBoxWidth","minCropBoxHeight","minContainerWidth","minContainerHeight","ready","cropstart","cropmove","cropend","crop","zoom","TEMPLATE","_typeof","obj","constructor","prototype","classCallCheck","instance","Constructor","TypeError","createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","protoProps","staticProps","get","object","property","receiver","Function","desc","undefined","parent","value","getter","call","set","setter","toConsumableArray","arr","Array","isArray","arr2","REGEXP_DATA_URL_HEAD","REGEXP_HYPHENATE","REGEXP_ORIGINS","REGEXP_SPACES","REGEXP_SUFFIX","REGEXP_TRIM","REGEXP_USERAGENT","navigator","window","IS_SAFARI_OR_UIWEBVIEW","test","userAgent","objectProto","Object","toString","hasOwnProperty","slice","fromCharCode","String","typeOf","toLowerCase","isNumber","num","isNaN","isUndefined","isObject","isPlainObject","_constructor","e","isFunction","fn","trim","str","replace","each","callback","forEach","extend","_len","arguments","args","_key","apply","concat","arg","proxy","context","_len2","_key2","_len3","args2","_key3","setStyle","element","styles","style","hasClass","classList","contains","className","indexOf","addClass","elem","add","removeClass","remove","toggleClass","added","hyphenate","getData$1","name","dataset","getAttribute","setData$1","setAttribute","removeData","removeAttribute","removeListener","type","handler","types","split","t","removeEventListener","detachEvent","addListener","_handler","once","originalHandler","_len4","_key4","addEventListener","attachEvent","dispatchEvent","event","Event","CustomEvent","bubbles","cancelable","detail","document","createEvent","initEvent","initCustomEvent","fireEvent","getEvent","srcElement","pageX","clientX","eventDoc","ownerDocument","doc","documentElement","body","scrollLeft","clientLeft","pageY","clientY","scrollTop","clientTop","getOffset","box","getBoundingClientRect","left","scrollX","top","scrollY","getByTag","tagName","getElementsByTagName","getByClass","getElementsByClassName","querySelectorAll","createElement","appendChild","removeChild","parentNode","empty","firstChild","isCrossOriginURL","url","parts","match","location","protocol","hostname","port","addTimestamp","timestamp","Date","getTime","getImageSize","image","naturalWidth","naturalHeight","newImage","onload","load","width","height","src","getTransforms","transforms","translateX","translateY","rotate","scaleX","scaleY","push","transform","join","WebkitTransform","msTransform","getRotatedSizes","reversed","deg","Math","abs","degree","arc","PI","sinArc","sin","cosArc","cos","newWidth","newHeight","getSourceCanvas","options","canvas","getContext","dstX","dstY","dstWidth","dstHeight","advanced","canvasWidth","canvasHeight","rotated","fillColor","fillStyle","fillRect","save","translate","scale","imageSmoothingEnabled","imageSmoothingQuality","drawImage","floor","getStringFromCharCode","dataView","start","getUint8","getOrientation","arrayBuffer","DataView","byteLength","orientation","exifIDCode","tiffOffset","firstIFDOffset","littleEndian","endianness","app1Start","ifdStart","offset","getUint16","getUint32","setUint16","dataURLToArrayBuffer","dataURL","base64","binary","atob","ArrayBuffer","Uint8Array","charCodeAt","arrayBufferToDataURL","btoa","render$1","render","self","initContainer","initCanvas","initCropBox","renderCanvas","cropped","renderCropBox","container","cropper","hidden","containerData","max","offsetWidth","Number","offsetHeight","imageData","canvasData","oldLeft","oldTop","limited","limitCanvas","initialImageData","initialCanvasData","sizeLimited","positionLimited","cropBoxData","minWidth","minHeight","maxWidth","Infinity","maxHeight","newCanvasLeft","newCanvasTop","minLeft","min","minTop","maxLeft","maxTop","changed","rotatedData","isSquareImage","rotatedData2","renderImage","limitCropBox","output","newImageData","reversedData","reversedWidth","reversedHeight","initialCropBoxData","maxCropBoxWidth","maxCropBoxHeight","face","cropBox","disabled","complete","getData","DATA_PREVIEW","preview$1","initPreview","crossOrigin","crossOriginUrl","viewBox","image2","previews","querySelector","img","html","innerHTML","cssText","resetPreview","cropBoxWidth","cropBoxHeight","originalWidth","originalHeight","ratio","PointerEvent","EVENT_POINTER_DOWN","EVENT_POINTER_MOVE","EVENT_POINTER_UP","EVENT_WHEEL","EVENT_DBLCLICK","EVENT_RESIZE","EVENT_CROP_START","EVENT_CROP_MOVE","EVENT_CROP_END","EVENT_CROP$1","EVENT_ZOOM","events","bind","onCropStart","cropStart","onWheel","wheel","onDblclick","dblclick","onCropMove","cropMove","onCropEnd","cropEnd","onResize","resize","unbind","REGEXP_ACTIONS","getPointer","_ref","endOnly","end","endX","endY","startX","startY","handlers","getCanvasData","getCropBoxData","setCanvasData","n","setCropBoxData","setDragMode","dragBox","delta","preventDefault","wheeling","setTimeout","deltaY","wheelDelta","pointers","action","changedTouches","touch","identifier","pointerId","originalEvent","cropping","change","ACTION_EAST","ACTION_WEST","ACTION_SOUTH","ACTION_NORTH","ACTION_SOUTH_EAST","ACTION_SOUTH_WEST","ACTION_NORTH_EAST","ACTION_NORTH_WEST","getMaxZoomRatio","pointers2","ratios","pointer","pointer2","x1","y1","x2","y2","z1","sqrt","z2","sort","a","b","change$1","right","bottom","renderable","shiftKey","range","x","y","X","Y","move","p","getPointersCenter","count","methods","reset","clear","onlyColorChanged","isImg","replaced","enable","disable","destroy","loaded","originalUrl","unbuild","onStart","offsetX","offsetY","moveTo","_originalEvent","zoomTo","oldRatio","rotateTo","_scaleX","_scaleY","rounded","round","setData","scaled","getContainerData","getImageData","widthChanged","heightChanged","getCroppedCanvas","HTMLCanvasElement","scaledWidth","scaledHeight","scaledRatio","parameters","source","sourceWidth","sourceHeight","params","srcX","srcY","srcWidth","srcHeight","setAspectRatio","mode","croppable","NAMESPACE","CLASS_HIDDEN","EVENT_ERROR","EVENT_LOAD","EVENT_READY","EVENT_CROP","REGEXP_DATA_URL","REGEXP_DATA_URL_JPEG","AnotherCropper","init","toDataURL","clone","read","xhr","XMLHttpRequest","onerror","onabort","response","open","responseType","withCredentials","send","stop","onStop","insertBefore","nextSibling","build","template","completing","clearTimeout","noConflict","setDefaults"],"mappings":"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","file":"cropper.js","sourcesContent":["/*!\n * Cropper.js v1.0.0-rc.3\n * https://github.com/fengyuanchen/cropperjs\n *\n * Copyright (c) 2017 Fengyuan Chen\n * Released under the MIT license\n *\n * Date: 2017-07-07T12:56:42.462Z\n */\n\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n  typeof define === 'function' && define.amd ? define(factory) :\n  (global.Cropper = factory());\n}(this, (function () { 'use strict';\n\nvar DEFAULTS = {\n  // Define the view mode of the cropper\n  viewMode: 0, // 0, 1, 2, 3\n\n  // Define the dragging mode of the cropper\n  dragMode: 'crop', // 'crop', 'move' or 'none'\n\n  // Define the aspect ratio of the crop box\n  aspectRatio: NaN,\n\n  // An object with the previous cropping result data\n  data: null,\n\n  // A selector for adding extra containers to preview\n  preview: '',\n\n  // Re-render the cropper when resize the window\n  responsive: true,\n\n  // Restore the cropped area after resize the window\n  restore: true,\n\n  // Check if the current image is a cross-origin image\n  checkCrossOrigin: true,\n\n  // Check the current image's Exif Orientation information\n  checkOrientation: true,\n\n  // Show the black modal\n  modal: true,\n\n  // Show the dashed lines for guiding\n  guides: true,\n\n  // Show the center indicator for guiding\n  center: true,\n\n  // Show the white modal to highlight the crop box\n  highlight: true,\n\n  // Show the grid background\n  background: true,\n\n  // Enable to crop the image automatically when initialize\n  autoCrop: true,\n\n  // Define the percentage of automatic cropping area when initializes\n  autoCropArea: 0.8,\n\n  // Enable to move the image\n  movable: true,\n\n  // Enable to rotate the image\n  rotatable: true,\n\n  // Enable to scale the image\n  scalable: true,\n\n  // Enable to zoom the image\n  zoomable: true,\n\n  // Enable to zoom the image by dragging touch\n  zoomOnTouch: true,\n\n  // Enable to zoom the image by wheeling mouse\n  zoomOnWheel: true,\n\n  // Define zoom ratio when zoom the image by wheeling mouse\n  wheelZoomRatio: 0.1,\n\n  // Enable to move the crop box\n  cropBoxMovable: true,\n\n  // Enable to resize the crop box\n  cropBoxResizable: true,\n\n  // Toggle drag mode between \"crop\" and \"move\" when click twice on the cropper\n  toggleDragModeOnDblclick: true,\n\n  // Size limitation\n  minCanvasWidth: 0,\n  minCanvasHeight: 0,\n  minCropBoxWidth: 0,\n  minCropBoxHeight: 0,\n  minContainerWidth: 200,\n  minContainerHeight: 100,\n\n  // Shortcuts of events\n  ready: null,\n  cropstart: null,\n  cropmove: null,\n  cropend: null,\n  crop: null,\n  zoom: null\n};\n\nvar TEMPLATE = '<div class=\"cropper-container\">' + '<div class=\"cropper-wrap-box\">' + '<div class=\"cropper-canvas\"></div>' + '</div>' + '<div class=\"cropper-drag-box\"></div>' + '<div class=\"cropper-crop-box\">' + '<span class=\"cropper-view-box\"></span>' + '<span class=\"cropper-dashed dashed-h\"></span>' + '<span class=\"cropper-dashed dashed-v\"></span>' + '<span class=\"cropper-center\"></span>' + '<span class=\"cropper-face\"></span>' + '<span class=\"cropper-line line-e\" data-action=\"e\"></span>' + '<span class=\"cropper-line line-n\" data-action=\"n\"></span>' + '<span class=\"cropper-line line-w\" data-action=\"w\"></span>' + '<span class=\"cropper-line line-s\" data-action=\"s\"></span>' + '<span class=\"cropper-point point-e\" data-action=\"e\"></span>' + '<span class=\"cropper-point point-n\" data-action=\"n\"></span>' + '<span class=\"cropper-point point-w\" data-action=\"w\"></span>' + '<span class=\"cropper-point point-s\" data-action=\"s\"></span>' + '<span class=\"cropper-point point-ne\" data-action=\"ne\"></span>' + '<span class=\"cropper-point point-nw\" data-action=\"nw\"></span>' + '<span class=\"cropper-point point-sw\" data-action=\"sw\"></span>' + '<span class=\"cropper-point point-se\" data-action=\"se\"></span>' + '</div>' + '</div>';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\n\n\n\n\n\n\n\n\n\n\n\nvar classCallCheck = function (instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n};\n\nvar createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\n\n\n\n\n\n\nvar get = function get(object, property, receiver) {\n  if (object === null) object = Function.prototype;\n  var desc = Object.getOwnPropertyDescriptor(object, property);\n\n  if (desc === undefined) {\n    var parent = Object.getPrototypeOf(object);\n\n    if (parent === null) {\n      return undefined;\n    } else {\n      return get(parent, property, receiver);\n    }\n  } else if (\"value\" in desc) {\n    return desc.value;\n  } else {\n    var getter = desc.get;\n\n    if (getter === undefined) {\n      return undefined;\n    }\n\n    return getter.call(receiver);\n  }\n};\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar set = function set(object, property, value, receiver) {\n  var desc = Object.getOwnPropertyDescriptor(object, property);\n\n  if (desc === undefined) {\n    var parent = Object.getPrototypeOf(object);\n\n    if (parent !== null) {\n      set(parent, property, value, receiver);\n    }\n  } else if (\"value\" in desc && desc.writable) {\n    desc.value = value;\n  } else {\n    var setter = desc.set;\n\n    if (setter !== undefined) {\n      setter.call(receiver, value);\n    }\n  }\n\n  return value;\n};\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar toConsumableArray = function (arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) arr2[i] = arr[i];\n\n    return arr2;\n  } else {\n    return Array.from(arr);\n  }\n};\n\n// RegExps\nvar REGEXP_DATA_URL_HEAD = /^data:.*,/;\nvar REGEXP_HYPHENATE = /([a-z\\d])([A-Z])/g;\nvar REGEXP_ORIGINS = /^(https?:)\\/\\/([^:/?#]+):?(\\d*)/i;\nvar REGEXP_SPACES = /\\s+/;\nvar REGEXP_SUFFIX = /^(width|height|left|top|marginLeft|marginTop)$/;\nvar REGEXP_TRIM = /^\\s+(.*)\\s+$/;\nvar REGEXP_USERAGENT = /(Macintosh|iPhone|iPod|iPad).*AppleWebKit/i;\n\n// Utilities\nvar navigator = typeof window !== 'undefined' ? window.navigator : null;\nvar IS_SAFARI_OR_UIWEBVIEW = navigator && REGEXP_USERAGENT.test(navigator.userAgent);\nvar objectProto = Object.prototype;\nvar toString = objectProto.toString;\nvar hasOwnProperty = objectProto.hasOwnProperty;\nvar slice = Array.prototype.slice;\nvar fromCharCode = String.fromCharCode;\n\nfunction typeOf(obj) {\n  return toString.call(obj).slice(8, -1).toLowerCase();\n}\n\nfunction isNumber(num) {\n  return typeof num === 'number' && !isNaN(num);\n}\n\nfunction isUndefined(obj) {\n  return typeof obj === 'undefined';\n}\n\nfunction isObject(obj) {\n  return (typeof obj === 'undefined' ? 'undefined' : _typeof(obj)) === 'object' && obj !== null;\n}\n\nfunction isPlainObject(obj) {\n  if (!isObject(obj)) {\n    return false;\n  }\n\n  try {\n    var _constructor = obj.constructor;\n    var prototype = _constructor.prototype;\n\n    return _constructor && prototype && hasOwnProperty.call(prototype, 'isPrototypeOf');\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction isFunction(fn) {\n  return typeOf(fn) === 'function';\n}\n\nfunction isArray(arr) {\n  return Array.isArray ? Array.isArray(arr) : typeOf(arr) === 'array';\n}\n\n\n\nfunction trim(str) {\n  if (typeof str === 'string') {\n    str = str.trim ? str.trim() : str.replace(REGEXP_TRIM, '$1');\n  }\n\n  return str;\n}\n\nfunction each(obj, callback) {\n  if (obj && isFunction(callback)) {\n    var i = void 0;\n\n    if (isArray(obj) || isNumber(obj.length) /* array-like */) {\n        var length = obj.length;\n\n        for (i = 0; i < length; i++) {\n          if (callback.call(obj, obj[i], i, obj) === false) {\n            break;\n          }\n        }\n      } else if (isObject(obj)) {\n      Object.keys(obj).forEach(function (key) {\n        callback.call(obj, obj[key], key, obj);\n      });\n    }\n  }\n\n  return obj;\n}\n\nfunction extend(obj) {\n  for (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n    args[_key - 1] = arguments[_key];\n  }\n\n  if (isObject(obj) && args.length > 0) {\n    if (Object.assign) {\n      return Object.assign.apply(Object, [obj].concat(args));\n    }\n\n    args.forEach(function (arg) {\n      if (isObject(arg)) {\n        Object.keys(arg).forEach(function (key) {\n          obj[key] = arg[key];\n        });\n      }\n    });\n  }\n\n  return obj;\n}\n\nfunction proxy(fn, context) {\n  for (var _len2 = arguments.length, args = Array(_len2 > 2 ? _len2 - 2 : 0), _key2 = 2; _key2 < _len2; _key2++) {\n    args[_key2 - 2] = arguments[_key2];\n  }\n\n  return function () {\n    for (var _len3 = arguments.length, args2 = Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n      args2[_key3] = arguments[_key3];\n    }\n\n    return fn.apply(context, args.concat(args2));\n  };\n}\n\nfunction setStyle(element, styles) {\n  var style = element.style;\n\n  each(styles, function (value, property) {\n    if (REGEXP_SUFFIX.test(property) && isNumber(value)) {\n      value += 'px';\n    }\n\n    style[property] = value;\n  });\n}\n\nfunction hasClass(element, value) {\n  return element.classList ? element.classList.contains(value) : element.className.indexOf(value) > -1;\n}\n\nfunction addClass(element, value) {\n  if (!value) {\n    return;\n  }\n\n  if (isNumber(element.length)) {\n    each(element, function (elem) {\n      addClass(elem, value);\n    });\n    return;\n  }\n\n  if (element.classList) {\n    element.classList.add(value);\n    return;\n  }\n\n  var className = trim(element.className);\n\n  if (!className) {\n    element.className = value;\n  } else if (className.indexOf(value) < 0) {\n    element.className = className + ' ' + value;\n  }\n}\n\nfunction removeClass(element, value) {\n  if (!value) {\n    return;\n  }\n\n  if (isNumber(element.length)) {\n    each(element, function (elem) {\n      removeClass(elem, value);\n    });\n    return;\n  }\n\n  if (element.classList) {\n    element.classList.remove(value);\n    return;\n  }\n\n  if (element.className.indexOf(value) >= 0) {\n    element.className = element.className.replace(value, '');\n  }\n}\n\nfunction toggleClass(element, value, added) {\n  if (!value) {\n    return;\n  }\n\n  if (isNumber(element.length)) {\n    each(element, function (elem) {\n      toggleClass(elem, value, added);\n    });\n    return;\n  }\n\n  // IE10-11 doesn't support the second parameter of `classList.toggle`\n  if (added) {\n    addClass(element, value);\n  } else {\n    removeClass(element, value);\n  }\n}\n\nfunction hyphenate(str) {\n  return str.replace(REGEXP_HYPHENATE, '$1-$2').toLowerCase();\n}\n\nfunction getData$1(element, name) {\n  if (isObject(element[name])) {\n    return element[name];\n  } else if (element.dataset) {\n    return element.dataset[name];\n  }\n\n  return element.getAttribute('data-' + hyphenate(name));\n}\n\nfunction setData$1(element, name, data) {\n  if (isObject(data)) {\n    element[name] = data;\n  } else if (element.dataset) {\n    element.dataset[name] = data;\n  } else {\n    element.setAttribute('data-' + hyphenate(name), data);\n  }\n}\n\nfunction removeData(element, name) {\n  if (isObject(element[name])) {\n    delete element[name];\n  } else if (element.dataset) {\n    // #128 Safari not allows to delete dataset property\n    try {\n      delete element.dataset[name];\n    } catch (e) {\n      element.dataset[name] = null;\n    }\n  } else {\n    element.removeAttribute('data-' + hyphenate(name));\n  }\n}\n\nfunction removeListener(element, type, handler) {\n  var types = trim(type).split(REGEXP_SPACES);\n\n  if (types.length > 1) {\n    each(types, function (t) {\n      removeListener(element, t, handler);\n    });\n    return;\n  }\n\n  if (element.removeEventListener) {\n    element.removeEventListener(type, handler, false);\n  } else if (element.detachEvent) {\n    element.detachEvent('on' + type, handler);\n  }\n}\n\nfunction addListener(element, type, _handler, once) {\n  var types = trim(type).split(REGEXP_SPACES);\n  var originalHandler = _handler;\n\n  if (types.length > 1) {\n    each(types, function (t) {\n      addListener(element, t, _handler);\n    });\n    return;\n  }\n\n  if (once) {\n    _handler = function handler() {\n      for (var _len4 = arguments.length, args = Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n        args[_key4] = arguments[_key4];\n      }\n\n      removeListener(element, type, _handler);\n\n      return originalHandler.apply(element, args);\n    };\n  }\n\n  if (element.addEventListener) {\n    element.addEventListener(type, _handler, false);\n  } else if (element.attachEvent) {\n    element.attachEvent('on' + type, _handler);\n  }\n}\n\nfunction dispatchEvent(element, type, data) {\n  if (element.dispatchEvent) {\n    var event = void 0;\n\n    // Event and CustomEvent on IE9-11 are global objects, not constructors\n    if (isFunction(Event) && isFunction(CustomEvent)) {\n      if (isUndefined(data)) {\n        event = new Event(type, {\n          bubbles: true,\n          cancelable: true\n        });\n      } else {\n        event = new CustomEvent(type, {\n          detail: data,\n          bubbles: true,\n          cancelable: true\n        });\n      }\n    } else if (isUndefined(data)) {\n      event = document.createEvent('Event');\n      event.initEvent(type, true, true);\n    } else {\n      event = document.createEvent('CustomEvent');\n      event.initCustomEvent(type, true, true, data);\n    }\n\n    // IE9+\n    return element.dispatchEvent(event);\n  } else if (element.fireEvent) {\n    // IE6-10 (native events only)\n    return element.fireEvent('on' + type);\n  }\n\n  return true;\n}\n\nfunction getEvent(event) {\n  var e = event || window.event;\n\n  // Fix target property (IE8)\n  if (!e.target) {\n    e.target = e.srcElement || document;\n  }\n\n  if (!isNumber(e.pageX) && isNumber(e.clientX)) {\n    var eventDoc = event.target.ownerDocument || document;\n    var doc = eventDoc.documentElement;\n    var body = eventDoc.body;\n\n    e.pageX = e.clientX + ((doc && doc.scrollLeft || body && body.scrollLeft || 0) - (doc && doc.clientLeft || body && body.clientLeft || 0));\n    e.pageY = e.clientY + ((doc && doc.scrollTop || body && body.scrollTop || 0) - (doc && doc.clientTop || body && body.clientTop || 0));\n  }\n\n  return e;\n}\n\nfunction getOffset(element) {\n  var doc = document.documentElement;\n  var box = element.getBoundingClientRect();\n\n  return {\n    left: box.left + ((window.scrollX || doc && doc.scrollLeft || 0) - (doc && doc.clientLeft || 0)),\n    top: box.top + ((window.scrollY || doc && doc.scrollTop || 0) - (doc && doc.clientTop || 0))\n  };\n}\n\nfunction getByTag(element, tagName) {\n  return element.getElementsByTagName(tagName);\n}\n\nfunction getByClass(element, className) {\n  return element.getElementsByClassName ? element.getElementsByClassName(className) : element.querySelectorAll('.' + className);\n}\n\nfunction createElement(tagName) {\n  return document.createElement(tagName);\n}\n\nfunction appendChild(element, elem) {\n  element.appendChild(elem);\n}\n\nfunction removeChild(element) {\n  if (element.parentNode) {\n    element.parentNode.removeChild(element);\n  }\n}\n\nfunction empty(element) {\n  while (element.firstChild) {\n    element.removeChild(element.firstChild);\n  }\n}\n\nfunction isCrossOriginURL(url) {\n  var parts = url.match(REGEXP_ORIGINS);\n\n  return parts && (parts[1] !== location.protocol || parts[2] !== location.hostname || parts[3] !== location.port);\n}\n\nfunction addTimestamp(url) {\n  var timestamp = 'timestamp=' + new Date().getTime();\n\n  return url + (url.indexOf('?') === -1 ? '?' : '&') + timestamp;\n}\n\nfunction getImageSize(image, callback) {\n  // Modern browsers (ignore Safari)\n  if (image.naturalWidth && !IS_SAFARI_OR_UIWEBVIEW) {\n    callback(image.naturalWidth, image.naturalHeight);\n    return;\n  }\n\n  // IE8: Don't use `new Image()` here\n  var newImage = createElement('img');\n\n  newImage.onload = function load() {\n    callback(this.width, this.height);\n  };\n\n  newImage.src = image.src;\n}\n\nfunction getTransforms(data) {\n  var transforms = [];\n  var translateX = data.translateX;\n  var translateY = data.translateY;\n  var rotate = data.rotate;\n  var scaleX = data.scaleX;\n  var scaleY = data.scaleY;\n\n  if (isNumber(translateX) && translateX !== 0) {\n    transforms.push('translateX(' + translateX + 'px)');\n  }\n\n  if (isNumber(translateY) && translateY !== 0) {\n    transforms.push('translateY(' + translateY + 'px)');\n  }\n\n  // Rotate should come first before scale to match orientation transform\n  if (isNumber(rotate) && rotate !== 0) {\n    transforms.push('rotate(' + rotate + 'deg)');\n  }\n\n  if (isNumber(scaleX) && scaleX !== 1) {\n    transforms.push('scaleX(' + scaleX + ')');\n  }\n\n  if (isNumber(scaleY) && scaleY !== 1) {\n    transforms.push('scaleY(' + scaleY + ')');\n  }\n\n  var transform = transforms.length ? transforms.join(' ') : 'none';\n\n  return {\n    WebkitTransform: transform,\n    msTransform: transform,\n    transform: transform\n  };\n}\n\nfunction getRotatedSizes(data, reversed) {\n  var deg = Math.abs(data.degree) % 180;\n  var arc = (deg > 90 ? 180 - deg : deg) * Math.PI / 180;\n  var sinArc = Math.sin(arc);\n  var cosArc = Math.cos(arc);\n  var width = data.width;\n  var height = data.height;\n  var aspectRatio = data.aspectRatio;\n  var newWidth = void 0;\n  var newHeight = void 0;\n\n  if (!reversed) {\n    newWidth = width * cosArc + height * sinArc;\n    newHeight = width * sinArc + height * cosArc;\n  } else {\n    newWidth = width / (cosArc + sinArc / aspectRatio);\n    newHeight = newWidth / aspectRatio;\n  }\n\n  return {\n    width: newWidth,\n    height: newHeight\n  };\n}\n\nfunction getSourceCanvas(image, data, options) {\n  var canvas = createElement('canvas');\n  var context = canvas.getContext('2d');\n  var dstX = 0;\n  var dstY = 0;\n  var dstWidth = data.naturalWidth;\n  var dstHeight = data.naturalHeight;\n  var rotate = data.rotate;\n  var scaleX = data.scaleX;\n  var scaleY = data.scaleY;\n  var scalable = isNumber(scaleX) && isNumber(scaleY) && (scaleX !== 1 || scaleY !== 1);\n  var rotatable = isNumber(rotate) && rotate !== 0;\n  var advanced = rotatable || scalable;\n  var canvasWidth = dstWidth * Math.abs(scaleX || 1);\n  var canvasHeight = dstHeight * Math.abs(scaleY || 1);\n  var translateX = void 0;\n  var translateY = void 0;\n  var rotated = void 0;\n\n  if (scalable) {\n    translateX = canvasWidth / 2;\n    translateY = canvasHeight / 2;\n  }\n\n  if (rotatable) {\n    rotated = getRotatedSizes({\n      width: canvasWidth,\n      height: canvasHeight,\n      degree: rotate\n    });\n\n    canvasWidth = rotated.width;\n    canvasHeight = rotated.height;\n    translateX = canvasWidth / 2;\n    translateY = canvasHeight / 2;\n  }\n\n  canvas.width = canvasWidth;\n  canvas.height = canvasHeight;\n\n  if (options.fillColor) {\n    context.fillStyle = options.fillColor;\n    context.fillRect(0, 0, canvasWidth, canvasHeight);\n  }\n\n  if (advanced) {\n    dstX = -dstWidth / 2;\n    dstY = -dstHeight / 2;\n\n    context.save();\n    context.translate(translateX, translateY);\n  }\n\n  // Rotate should come first before scale as in the \"getTransform\" function\n  if (rotatable) {\n    context.rotate(rotate * Math.PI / 180);\n  }\n\n  if (scalable) {\n    context.scale(scaleX, scaleY);\n  }\n\n  context.imageSmoothingEnabled = !!options.imageSmoothingEnabled;\n\n  if (options.imageSmoothingQuality) {\n    context.imageSmoothingQuality = options.imageSmoothingQuality;\n  }\n\n  context.drawImage(image, Math.floor(dstX), Math.floor(dstY), Math.floor(dstWidth), Math.floor(dstHeight));\n\n  if (advanced) {\n    context.restore();\n  }\n\n  return canvas;\n}\n\nfunction getStringFromCharCode(dataView, start, length) {\n  var str = '';\n  var i = start;\n\n  for (length += start; i < length; i++) {\n    str += fromCharCode(dataView.getUint8(i));\n  }\n\n  return str;\n}\n\nfunction getOrientation(arrayBuffer) {\n  var dataView = new DataView(arrayBuffer);\n  var length = dataView.byteLength;\n  var orientation = void 0;\n  var exifIDCode = void 0;\n  var tiffOffset = void 0;\n  var firstIFDOffset = void 0;\n  var littleEndian = void 0;\n  var endianness = void 0;\n  var app1Start = void 0;\n  var ifdStart = void 0;\n  var offset = void 0;\n  var i = void 0;\n\n  // Only handle JPEG image (start by 0xFFD8)\n  if (dataView.getUint8(0) === 0xFF && dataView.getUint8(1) === 0xD8) {\n    offset = 2;\n\n    while (offset < length) {\n      if (dataView.getUint8(offset) === 0xFF && dataView.getUint8(offset + 1) === 0xE1) {\n        app1Start = offset;\n        break;\n      }\n\n      offset++;\n    }\n  }\n\n  if (app1Start) {\n    exifIDCode = app1Start + 4;\n    tiffOffset = app1Start + 10;\n\n    if (getStringFromCharCode(dataView, exifIDCode, 4) === 'Exif') {\n      endianness = dataView.getUint16(tiffOffset);\n      littleEndian = endianness === 0x4949;\n\n      if (littleEndian || endianness === 0x4D4D /* bigEndian */) {\n          if (dataView.getUint16(tiffOffset + 2, littleEndian) === 0x002A) {\n            firstIFDOffset = dataView.getUint32(tiffOffset + 4, littleEndian);\n\n            if (firstIFDOffset >= 0x00000008) {\n              ifdStart = tiffOffset + firstIFDOffset;\n            }\n          }\n        }\n    }\n  }\n\n  if (ifdStart) {\n    length = dataView.getUint16(ifdStart, littleEndian);\n\n    for (i = 0; i < length; i++) {\n      offset = ifdStart + i * 12 + 2;\n\n      if (dataView.getUint16(offset, littleEndian) === 0x0112 /* Orientation */) {\n          // 8 is the offset of the current tag's value\n          offset += 8;\n\n          // Get the original orientation value\n          orientation = dataView.getUint16(offset, littleEndian);\n\n          // Override the orientation with its default value for Safari\n          if (IS_SAFARI_OR_UIWEBVIEW) {\n            dataView.setUint16(offset, 1, littleEndian);\n          }\n\n          break;\n        }\n    }\n  }\n\n  return orientation;\n}\n\nfunction dataURLToArrayBuffer(dataURL) {\n  var base64 = dataURL.replace(REGEXP_DATA_URL_HEAD, '');\n  var binary = atob(base64);\n  var length = binary.length;\n  var arrayBuffer = new ArrayBuffer(length);\n  var dataView = new Uint8Array(arrayBuffer);\n  var i = void 0;\n\n  for (i = 0; i < length; i++) {\n    dataView[i] = binary.charCodeAt(i);\n  }\n\n  return arrayBuffer;\n}\n\n// Only available for JPEG image\nfunction arrayBufferToDataURL(arrayBuffer) {\n  var dataView = new Uint8Array(arrayBuffer);\n  var length = dataView.length;\n  var base64 = '';\n  var i = void 0;\n\n  for (i = 0; i < length; i++) {\n    base64 += fromCharCode(dataView[i]);\n  }\n\n  return 'data:image/jpeg;base64,' + btoa(base64);\n}\n\nvar render$1 = {\n  render: function render() {\n    var self = this;\n\n    self.initContainer();\n    self.initCanvas();\n    self.initCropBox();\n\n    self.renderCanvas();\n\n    if (self.cropped) {\n      self.renderCropBox();\n    }\n  },\n  initContainer: function initContainer() {\n    var self = this;\n    var options = self.options;\n    var element = self.element;\n    var container = self.container;\n    var cropper = self.cropper;\n    var hidden = 'cropper-hidden';\n    var containerData = void 0;\n\n    addClass(cropper, hidden);\n    removeClass(element, hidden);\n\n    self.containerData = containerData = {\n      width: Math.max(container.offsetWidth, Number(options.minContainerWidth) || 200),\n      height: Math.max(container.offsetHeight, Number(options.minContainerHeight) || 100)\n    };\n\n    setStyle(cropper, {\n      width: containerData.width,\n      height: containerData.height\n    });\n\n    addClass(element, hidden);\n    removeClass(cropper, hidden);\n  },\n\n\n  // Canvas (image wrapper)\n  initCanvas: function initCanvas() {\n    var self = this;\n    var viewMode = self.options.viewMode;\n    var containerData = self.containerData;\n    var imageData = self.imageData;\n    var rotated = Math.abs(imageData.rotate) % 180 === 90;\n    var naturalWidth = rotated ? imageData.naturalHeight : imageData.naturalWidth;\n    var naturalHeight = rotated ? imageData.naturalWidth : imageData.naturalHeight;\n    var aspectRatio = naturalWidth / naturalHeight;\n    var canvasWidth = containerData.width;\n    var canvasHeight = containerData.height;\n\n    if (containerData.height * aspectRatio > containerData.width) {\n      if (viewMode === 3) {\n        canvasWidth = containerData.height * aspectRatio;\n      } else {\n        canvasHeight = containerData.width / aspectRatio;\n      }\n    } else if (viewMode === 3) {\n      canvasHeight = containerData.width / aspectRatio;\n    } else {\n      canvasWidth = containerData.height * aspectRatio;\n    }\n\n    var canvasData = {\n      naturalWidth: naturalWidth,\n      naturalHeight: naturalHeight,\n      aspectRatio: aspectRatio,\n      width: canvasWidth,\n      height: canvasHeight\n    };\n\n    canvasData.oldLeft = canvasData.left = (containerData.width - canvasWidth) / 2;\n    canvasData.oldTop = canvasData.top = (containerData.height - canvasHeight) / 2;\n\n    self.canvasData = canvasData;\n    self.limited = viewMode === 1 || viewMode === 2;\n    self.limitCanvas(true, true);\n    self.initialImageData = extend({}, imageData);\n    self.initialCanvasData = extend({}, canvasData);\n  },\n  limitCanvas: function limitCanvas(sizeLimited, positionLimited) {\n    var self = this;\n    var options = self.options;\n    var viewMode = options.viewMode;\n    var containerData = self.containerData;\n    var canvasData = self.canvasData;\n    var aspectRatio = canvasData.aspectRatio;\n    var cropBoxData = self.cropBoxData;\n    var cropped = self.cropped && cropBoxData;\n\n    if (sizeLimited) {\n      var minCanvasWidth = Number(options.minCanvasWidth) || 0;\n      var minCanvasHeight = Number(options.minCanvasHeight) || 0;\n\n      if (viewMode > 1) {\n        minCanvasWidth = Math.max(minCanvasWidth, containerData.width);\n        minCanvasHeight = Math.max(minCanvasHeight, containerData.height);\n\n        if (viewMode === 3) {\n          if (minCanvasHeight * aspectRatio > minCanvasWidth) {\n            minCanvasWidth = minCanvasHeight * aspectRatio;\n          } else {\n            minCanvasHeight = minCanvasWidth / aspectRatio;\n          }\n        }\n      } else if (viewMode > 0) {\n        if (minCanvasWidth) {\n          minCanvasWidth = Math.max(minCanvasWidth, cropped ? cropBoxData.width : 0);\n        } else if (minCanvasHeight) {\n          minCanvasHeight = Math.max(minCanvasHeight, cropped ? cropBoxData.height : 0);\n        } else if (cropped) {\n          minCanvasWidth = cropBoxData.width;\n          minCanvasHeight = cropBoxData.height;\n\n          if (minCanvasHeight * aspectRatio > minCanvasWidth) {\n            minCanvasWidth = minCanvasHeight * aspectRatio;\n          } else {\n            minCanvasHeight = minCanvasWidth / aspectRatio;\n          }\n        }\n      }\n\n      if (minCanvasWidth && minCanvasHeight) {\n        if (minCanvasHeight * aspectRatio > minCanvasWidth) {\n          minCanvasHeight = minCanvasWidth / aspectRatio;\n        } else {\n          minCanvasWidth = minCanvasHeight * aspectRatio;\n        }\n      } else if (minCanvasWidth) {\n        minCanvasHeight = minCanvasWidth / aspectRatio;\n      } else if (minCanvasHeight) {\n        minCanvasWidth = minCanvasHeight * aspectRatio;\n      }\n\n      canvasData.minWidth = minCanvasWidth;\n      canvasData.minHeight = minCanvasHeight;\n      canvasData.maxWidth = Infinity;\n      canvasData.maxHeight = Infinity;\n    }\n\n    if (positionLimited) {\n      if (viewMode) {\n        var newCanvasLeft = containerData.width - canvasData.width;\n        var newCanvasTop = containerData.height - canvasData.height;\n\n        canvasData.minLeft = Math.min(0, newCanvasLeft);\n        canvasData.minTop = Math.min(0, newCanvasTop);\n        canvasData.maxLeft = Math.max(0, newCanvasLeft);\n        canvasData.maxTop = Math.max(0, newCanvasTop);\n\n        if (cropped && self.limited) {\n          canvasData.minLeft = Math.min(cropBoxData.left, cropBoxData.left + (cropBoxData.width - canvasData.width));\n          canvasData.minTop = Math.min(cropBoxData.top, cropBoxData.top + (cropBoxData.height - canvasData.height));\n          canvasData.maxLeft = cropBoxData.left;\n          canvasData.maxTop = cropBoxData.top;\n\n          if (viewMode === 2) {\n            if (canvasData.width >= containerData.width) {\n              canvasData.minLeft = Math.min(0, newCanvasLeft);\n              canvasData.maxLeft = Math.max(0, newCanvasLeft);\n            }\n\n            if (canvasData.height >= containerData.height) {\n              canvasData.minTop = Math.min(0, newCanvasTop);\n              canvasData.maxTop = Math.max(0, newCanvasTop);\n            }\n          }\n        }\n      } else {\n        canvasData.minLeft = -canvasData.width;\n        canvasData.minTop = -canvasData.height;\n        canvasData.maxLeft = containerData.width;\n        canvasData.maxTop = containerData.height;\n      }\n    }\n  },\n  renderCanvas: function renderCanvas(changed) {\n    var self = this;\n    var canvasData = self.canvasData;\n    var imageData = self.imageData;\n    var rotate = imageData.rotate;\n\n    if (self.rotated) {\n      self.rotated = false;\n\n      // Computes rotated sizes with image sizes\n      var rotatedData = getRotatedSizes({\n        width: imageData.width,\n        height: imageData.height,\n        degree: rotate\n      });\n      var aspectRatio = rotatedData.width / rotatedData.height;\n      var isSquareImage = imageData.aspectRatio === 1;\n\n      if (isSquareImage || aspectRatio !== canvasData.aspectRatio) {\n        canvasData.left -= (rotatedData.width - canvasData.width) / 2;\n        canvasData.top -= (rotatedData.height - canvasData.height) / 2;\n        canvasData.width = rotatedData.width;\n        canvasData.height = rotatedData.height;\n        canvasData.aspectRatio = aspectRatio;\n        canvasData.naturalWidth = imageData.naturalWidth;\n        canvasData.naturalHeight = imageData.naturalHeight;\n\n        // Computes rotated sizes with natural image sizes\n        if (isSquareImage && rotate % 90 || rotate % 180) {\n          var rotatedData2 = getRotatedSizes({\n            width: imageData.naturalWidth,\n            height: imageData.naturalHeight,\n            degree: rotate\n          });\n\n          canvasData.naturalWidth = rotatedData2.width;\n          canvasData.naturalHeight = rotatedData2.height;\n        }\n\n        self.limitCanvas(true, false);\n      }\n    }\n\n    if (canvasData.width > canvasData.maxWidth || canvasData.width < canvasData.minWidth) {\n      canvasData.left = canvasData.oldLeft;\n    }\n\n    if (canvasData.height > canvasData.maxHeight || canvasData.height < canvasData.minHeight) {\n      canvasData.top = canvasData.oldTop;\n    }\n\n    canvasData.width = Math.min(Math.max(canvasData.width, canvasData.minWidth), canvasData.maxWidth);\n    canvasData.height = Math.min(Math.max(canvasData.height, canvasData.minHeight), canvasData.maxHeight);\n\n    self.limitCanvas(false, true);\n\n    canvasData.oldLeft = canvasData.left = Math.min(Math.max(canvasData.left, canvasData.minLeft), canvasData.maxLeft);\n    canvasData.oldTop = canvasData.top = Math.min(Math.max(canvasData.top, canvasData.minTop), canvasData.maxTop);\n\n    setStyle(self.canvas, extend({\n      width: canvasData.width,\n      height: canvasData.height\n    }, getTransforms({\n      translateX: canvasData.left,\n      translateY: canvasData.top\n    })));\n\n    self.renderImage();\n\n    if (self.cropped && self.limited) {\n      self.limitCropBox(true, true);\n    }\n\n    if (changed) {\n      self.output();\n    }\n  },\n  renderImage: function renderImage(changed) {\n    var self = this;\n    var canvasData = self.canvasData;\n    var imageData = self.imageData;\n    var newImageData = void 0;\n    var reversedData = void 0;\n    var reversedWidth = void 0;\n    var reversedHeight = void 0;\n\n    if (imageData.rotate) {\n      reversedData = getRotatedSizes({\n        width: canvasData.width,\n        height: canvasData.height,\n        degree: imageData.rotate,\n        aspectRatio: imageData.aspectRatio\n      }, true);\n\n      reversedWidth = reversedData.width;\n      reversedHeight = reversedData.height;\n\n      newImageData = {\n        width: reversedWidth,\n        height: reversedHeight,\n        left: (canvasData.width - reversedWidth) / 2,\n        top: (canvasData.height - reversedHeight) / 2\n      };\n    }\n\n    extend(imageData, newImageData || {\n      width: canvasData.width,\n      height: canvasData.height,\n      left: 0,\n      top: 0\n    });\n\n    setStyle(self.image, extend({\n      width: imageData.width,\n      height: imageData.height\n    }, getTransforms(extend({\n      translateX: imageData.left,\n      translateY: imageData.top\n    }, imageData))));\n\n    if (changed) {\n      self.output();\n    }\n  },\n  initCropBox: function initCropBox() {\n    var self = this;\n    var options = self.options;\n    var aspectRatio = options.aspectRatio;\n    var autoCropArea = Number(options.autoCropArea) || 0.8;\n    var canvasData = self.canvasData;\n    var cropBoxData = {\n      width: canvasData.width,\n      height: canvasData.height\n    };\n\n    if (aspectRatio) {\n      if (canvasData.height * aspectRatio > canvasData.width) {\n        cropBoxData.height = cropBoxData.width / aspectRatio;\n      } else {\n        cropBoxData.width = cropBoxData.height * aspectRatio;\n      }\n    }\n\n    self.cropBoxData = cropBoxData;\n    self.limitCropBox(true, true);\n\n    // Initialize auto crop area\n    cropBoxData.width = Math.min(Math.max(cropBoxData.width, cropBoxData.minWidth), cropBoxData.maxWidth);\n    cropBoxData.height = Math.min(Math.max(cropBoxData.height, cropBoxData.minHeight), cropBoxData.maxHeight);\n\n    // The width/height of auto crop area must large than \"minWidth/Height\"\n    cropBoxData.width = Math.max(cropBoxData.minWidth, cropBoxData.width * autoCropArea);\n    cropBoxData.height = Math.max(cropBoxData.minHeight, cropBoxData.height * autoCropArea);\n    cropBoxData.oldLeft = cropBoxData.left = canvasData.left + (canvasData.width - cropBoxData.width) / 2;\n    cropBoxData.oldTop = cropBoxData.top = canvasData.top + (canvasData.height - cropBoxData.height) / 2;\n\n    self.initialCropBoxData = extend({}, cropBoxData);\n  },\n  limitCropBox: function limitCropBox(sizeLimited, positionLimited) {\n    var self = this;\n    var options = self.options;\n    var aspectRatio = options.aspectRatio;\n    var containerData = self.containerData;\n    var canvasData = self.canvasData;\n    var cropBoxData = self.cropBoxData;\n    var limited = self.limited;\n\n    if (sizeLimited) {\n      var minCropBoxWidth = Number(options.minCropBoxWidth) || 0;\n      var minCropBoxHeight = Number(options.minCropBoxHeight) || 0;\n      var maxCropBoxWidth = Math.min(containerData.width, limited ? canvasData.width : containerData.width);\n      var maxCropBoxHeight = Math.min(containerData.height, limited ? canvasData.height : containerData.height);\n\n      // The min/maxCropBoxWidth/Height must be less than containerWidth/Height\n      minCropBoxWidth = Math.min(minCropBoxWidth, containerData.width);\n      minCropBoxHeight = Math.min(minCropBoxHeight, containerData.height);\n\n      if (aspectRatio) {\n        if (minCropBoxWidth && minCropBoxHeight) {\n          if (minCropBoxHeight * aspectRatio > minCropBoxWidth) {\n            minCropBoxHeight = minCropBoxWidth / aspectRatio;\n          } else {\n            minCropBoxWidth = minCropBoxHeight * aspectRatio;\n          }\n        } else if (minCropBoxWidth) {\n          minCropBoxHeight = minCropBoxWidth / aspectRatio;\n        } else if (minCropBoxHeight) {\n          minCropBoxWidth = minCropBoxHeight * aspectRatio;\n        }\n\n        if (maxCropBoxHeight * aspectRatio > maxCropBoxWidth) {\n          maxCropBoxHeight = maxCropBoxWidth / aspectRatio;\n        } else {\n          maxCropBoxWidth = maxCropBoxHeight * aspectRatio;\n        }\n      }\n\n      // The minWidth/Height must be less than maxWidth/Height\n      cropBoxData.minWidth = Math.min(minCropBoxWidth, maxCropBoxWidth);\n      cropBoxData.minHeight = Math.min(minCropBoxHeight, maxCropBoxHeight);\n      cropBoxData.maxWidth = maxCropBoxWidth;\n      cropBoxData.maxHeight = maxCropBoxHeight;\n    }\n\n    if (positionLimited) {\n      if (limited) {\n        cropBoxData.minLeft = Math.max(0, canvasData.left);\n        cropBoxData.minTop = Math.max(0, canvasData.top);\n        cropBoxData.maxLeft = Math.min(containerData.width, canvasData.left + canvasData.width) - cropBoxData.width;\n        cropBoxData.maxTop = Math.min(containerData.height, canvasData.top + canvasData.height) - cropBoxData.height;\n      } else {\n        cropBoxData.minLeft = 0;\n        cropBoxData.minTop = 0;\n        cropBoxData.maxLeft = containerData.width - cropBoxData.width;\n        cropBoxData.maxTop = containerData.height - cropBoxData.height;\n      }\n    }\n  },\n  renderCropBox: function renderCropBox() {\n    var self = this;\n    var options = self.options;\n    var containerData = self.containerData;\n    var cropBoxData = self.cropBoxData;\n\n    if (cropBoxData.width > cropBoxData.maxWidth || cropBoxData.width < cropBoxData.minWidth) {\n      cropBoxData.left = cropBoxData.oldLeft;\n    }\n\n    if (cropBoxData.height > cropBoxData.maxHeight || cropBoxData.height < cropBoxData.minHeight) {\n      cropBoxData.top = cropBoxData.oldTop;\n    }\n\n    cropBoxData.width = Math.min(Math.max(cropBoxData.width, cropBoxData.minWidth), cropBoxData.maxWidth);\n    cropBoxData.height = Math.min(Math.max(cropBoxData.height, cropBoxData.minHeight), cropBoxData.maxHeight);\n\n    self.limitCropBox(false, true);\n\n    cropBoxData.oldLeft = cropBoxData.left = Math.min(Math.max(cropBoxData.left, cropBoxData.minLeft), cropBoxData.maxLeft);\n    cropBoxData.oldTop = cropBoxData.top = Math.min(Math.max(cropBoxData.top, cropBoxData.minTop), cropBoxData.maxTop);\n\n    if (options.movable && options.cropBoxMovable) {\n      // Turn to move the canvas when the crop box is equal to the container\n      setData$1(self.face, 'action', cropBoxData.width === containerData.width && cropBoxData.height === containerData.height ? 'move' : 'all');\n    }\n\n    setStyle(self.cropBox, extend({\n      width: cropBoxData.width,\n      height: cropBoxData.height\n    }, getTransforms({\n      translateX: cropBoxData.left,\n      translateY: cropBoxData.top\n    })));\n\n    if (self.cropped && self.limited) {\n      self.limitCanvas(true, true);\n    }\n\n    if (!self.disabled) {\n      self.output();\n    }\n  },\n  output: function output() {\n    var self = this;\n\n    self.preview();\n\n    if (self.complete) {\n      dispatchEvent(self.element, 'crop', self.getData());\n    }\n  }\n};\n\nvar DATA_PREVIEW = 'preview';\n\nvar preview$1 = {\n  initPreview: function initPreview() {\n    var self = this;\n    var preview = self.options.preview;\n    var image = createElement('img');\n    var crossOrigin = self.crossOrigin;\n    var url = crossOrigin ? self.crossOriginUrl : self.url;\n\n    if (crossOrigin) {\n      image.crossOrigin = crossOrigin;\n    }\n\n    image.src = url;\n    appendChild(self.viewBox, image);\n    self.image2 = image;\n\n    if (!preview) {\n      return;\n    }\n\n    var previews = preview.querySelector ? [preview] : document.querySelectorAll(preview);\n\n    self.previews = previews;\n\n    each(previews, function (element) {\n      var img = createElement('img');\n\n      // Save the original size for recover\n      setData$1(element, DATA_PREVIEW, {\n        width: element.offsetWidth,\n        height: element.offsetHeight,\n        html: element.innerHTML\n      });\n\n      if (crossOrigin) {\n        img.crossOrigin = crossOrigin;\n      }\n\n      img.src = url;\n\n      /**\n       * Override img element styles\n       * Add `display:block` to avoid margin top issue\n       * Add `height:auto` to override `height` attribute on IE8\n       * (Occur only when margin-top <= -height)\n       */\n\n      img.style.cssText = 'display:block;' + 'width:100%;' + 'height:auto;' + 'min-width:0!important;' + 'min-height:0!important;' + 'max-width:none!important;' + 'max-height:none!important;' + 'image-orientation:0deg!important;\"';\n\n      empty(element);\n      appendChild(element, img);\n    });\n  },\n  resetPreview: function resetPreview() {\n    each(this.previews, function (element) {\n      var data = getData$1(element, DATA_PREVIEW);\n\n      setStyle(element, {\n        width: data.width,\n        height: data.height\n      });\n\n      element.innerHTML = data.html;\n      removeData(element, DATA_PREVIEW);\n    });\n  },\n  preview: function preview() {\n    var self = this;\n    var imageData = self.imageData;\n    var canvasData = self.canvasData;\n    var cropBoxData = self.cropBoxData;\n    var cropBoxWidth = cropBoxData.width;\n    var cropBoxHeight = cropBoxData.height;\n    var width = imageData.width;\n    var height = imageData.height;\n    var left = cropBoxData.left - canvasData.left - imageData.left;\n    var top = cropBoxData.top - canvasData.top - imageData.top;\n\n    if (!self.cropped || self.disabled) {\n      return;\n    }\n\n    setStyle(self.image2, extend({\n      width: width,\n      height: height\n    }, getTransforms(extend({\n      translateX: -left,\n      translateY: -top\n    }, imageData))));\n\n    each(self.previews, function (element) {\n      var data = getData$1(element, DATA_PREVIEW);\n      var originalWidth = data.width;\n      var originalHeight = data.height;\n      var newWidth = originalWidth;\n      var newHeight = originalHeight;\n      var ratio = 1;\n\n      if (cropBoxWidth) {\n        ratio = originalWidth / cropBoxWidth;\n        newHeight = cropBoxHeight * ratio;\n      }\n\n      if (cropBoxHeight && newHeight > originalHeight) {\n        ratio = originalHeight / cropBoxHeight;\n        newWidth = cropBoxWidth * ratio;\n        newHeight = originalHeight;\n      }\n\n      setStyle(element, {\n        width: newWidth,\n        height: newHeight\n      });\n\n      setStyle(getByTag(element, 'img')[0], extend({\n        width: width * ratio,\n        height: height * ratio\n      }, getTransforms(extend({\n        translateX: -left * ratio,\n        translateY: -top * ratio\n      }, imageData))));\n    });\n  }\n};\n\n// Globals\nvar PointerEvent = typeof window !== 'undefined' ? window.PointerEvent : null;\n\n// Events\nvar EVENT_POINTER_DOWN = PointerEvent ? 'pointerdown' : 'touchstart mousedown';\nvar EVENT_POINTER_MOVE = PointerEvent ? 'pointermove' : 'touchmove mousemove';\nvar EVENT_POINTER_UP = PointerEvent ? ' pointerup pointercancel' : 'touchend touchcancel mouseup';\nvar EVENT_WHEEL = 'wheel mousewheel DOMMouseScroll';\nvar EVENT_DBLCLICK = 'dblclick';\nvar EVENT_RESIZE = 'resize';\nvar EVENT_CROP_START = 'cropstart';\nvar EVENT_CROP_MOVE = 'cropmove';\nvar EVENT_CROP_END = 'cropend';\nvar EVENT_CROP$1 = 'crop';\nvar EVENT_ZOOM = 'zoom';\n\nvar events = {\n  bind: function bind() {\n    var self = this;\n    var options = self.options;\n    var element = self.element;\n    var cropper = self.cropper;\n\n    if (isFunction(options.cropstart)) {\n      addListener(element, EVENT_CROP_START, options.cropstart);\n    }\n\n    if (isFunction(options.cropmove)) {\n      addListener(element, EVENT_CROP_MOVE, options.cropmove);\n    }\n\n    if (isFunction(options.cropend)) {\n      addListener(element, EVENT_CROP_END, options.cropend);\n    }\n\n    if (isFunction(options.crop)) {\n      addListener(element, EVENT_CROP$1, options.crop);\n    }\n\n    if (isFunction(options.zoom)) {\n      addListener(element, EVENT_ZOOM, options.zoom);\n    }\n\n    addListener(cropper, EVENT_POINTER_DOWN, self.onCropStart = proxy(self.cropStart, self));\n\n    if (options.zoomable && options.zoomOnWheel) {\n      addListener(cropper, EVENT_WHEEL, self.onWheel = proxy(self.wheel, self));\n    }\n\n    if (options.toggleDragModeOnDblclick) {\n      addListener(cropper, EVENT_DBLCLICK, self.onDblclick = proxy(self.dblclick, self));\n    }\n\n    addListener(document, EVENT_POINTER_MOVE, self.onCropMove = proxy(self.cropMove, self));\n    addListener(document, EVENT_POINTER_UP, self.onCropEnd = proxy(self.cropEnd, self));\n\n    if (options.responsive) {\n      addListener(window, EVENT_RESIZE, self.onResize = proxy(self.resize, self));\n    }\n  },\n  unbind: function unbind() {\n    var self = this;\n    var options = self.options;\n    var element = self.element;\n    var cropper = self.cropper;\n\n    if (isFunction(options.cropstart)) {\n      removeListener(element, EVENT_CROP_START, options.cropstart);\n    }\n\n    if (isFunction(options.cropmove)) {\n      removeListener(element, EVENT_CROP_MOVE, options.cropmove);\n    }\n\n    if (isFunction(options.cropend)) {\n      removeListener(element, EVENT_CROP_END, options.cropend);\n    }\n\n    if (isFunction(options.crop)) {\n      removeListener(element, EVENT_CROP$1, options.crop);\n    }\n\n    if (isFunction(options.zoom)) {\n      removeListener(element, EVENT_ZOOM, options.zoom);\n    }\n\n    removeListener(cropper, EVENT_POINTER_DOWN, self.onCropStart);\n\n    if (options.zoomable && options.zoomOnWheel) {\n      removeListener(cropper, EVENT_WHEEL, self.onWheel);\n    }\n\n    if (options.toggleDragModeOnDblclick) {\n      removeListener(cropper, EVENT_DBLCLICK, self.onDblclick);\n    }\n\n    removeListener(document, EVENT_POINTER_MOVE, self.onCropMove);\n    removeListener(document, EVENT_POINTER_UP, self.onCropEnd);\n\n    if (options.responsive) {\n      removeListener(window, EVENT_RESIZE, self.onResize);\n    }\n  }\n};\n\nvar REGEXP_ACTIONS = /^(e|w|s|n|se|sw|ne|nw|all|crop|move|zoom)$/;\n\nfunction getPointer(_ref, endOnly) {\n  var pageX = _ref.pageX,\n      pageY = _ref.pageY;\n\n  var end = {\n    endX: pageX,\n    endY: pageY\n  };\n\n  if (endOnly) {\n    return end;\n  }\n\n  return extend({\n    startX: pageX,\n    startY: pageY\n  }, end);\n}\n\nvar handlers = {\n  resize: function resize() {\n    var self = this;\n    var options = self.options;\n    var container = self.container;\n    var containerData = self.containerData;\n    var minContainerWidth = Number(options.minContainerWidth) || 200;\n    var minContainerHeight = Number(options.minContainerHeight) || 100;\n\n    if (self.disabled || containerData.width === minContainerWidth || containerData.height === minContainerHeight) {\n      return;\n    }\n\n    var ratio = container.offsetWidth / containerData.width;\n\n    // Resize when width changed or height changed\n    if (ratio !== 1 || container.offsetHeight !== containerData.height) {\n      (function () {\n        var canvasData = void 0;\n        var cropBoxData = void 0;\n\n        if (options.restore) {\n          canvasData = self.getCanvasData();\n          cropBoxData = self.getCropBoxData();\n        }\n\n        self.render();\n\n        if (options.restore) {\n          self.setCanvasData(each(canvasData, function (n, i) {\n            canvasData[i] = n * ratio;\n          }));\n          self.setCropBoxData(each(cropBoxData, function (n, i) {\n            cropBoxData[i] = n * ratio;\n          }));\n        }\n      })();\n    }\n  },\n  dblclick: function dblclick() {\n    var self = this;\n\n    if (self.disabled || self.options.dragMode === 'none') {\n      return;\n    }\n\n    self.setDragMode(hasClass(self.dragBox, 'cropper-crop') ? 'move' : 'crop');\n  },\n  wheel: function wheel(event) {\n    var self = this;\n    var e = getEvent(event);\n    var ratio = Number(self.options.wheelZoomRatio) || 0.1;\n    var delta = 1;\n\n    if (self.disabled) {\n      return;\n    }\n\n    e.preventDefault();\n\n    // Limit wheel speed to prevent zoom too fast (#21)\n    if (self.wheeling) {\n      return;\n    }\n\n    self.wheeling = true;\n\n    setTimeout(function () {\n      self.wheeling = false;\n    }, 50);\n\n    if (e.deltaY) {\n      delta = e.deltaY > 0 ? 1 : -1;\n    } else if (e.wheelDelta) {\n      delta = -e.wheelDelta / 120;\n    } else if (e.detail) {\n      delta = e.detail > 0 ? 1 : -1;\n    }\n\n    self.zoom(-delta * ratio, e);\n  },\n  cropStart: function cropStart(event) {\n    var self = this;\n\n    if (self.disabled) {\n      return;\n    }\n\n    var options = self.options;\n    var pointers = self.pointers;\n    var e = getEvent(event);\n    var action = void 0;\n\n    if (e.changedTouches) {\n      // Handle touch event\n      each(e.changedTouches, function (touch) {\n        pointers[touch.identifier] = getPointer(touch);\n      });\n    } else {\n      // Handle mouse event and pointer event\n      pointers[e.pointerId || 0] = getPointer(e);\n    }\n\n    if (Object.keys(pointers).length > 1 && options.zoomable && options.zoomOnTouch) {\n      action = 'zoom';\n    } else {\n      action = getData$1(e.target, 'action');\n    }\n\n    if (!REGEXP_ACTIONS.test(action)) {\n      return;\n    }\n\n    if (dispatchEvent(self.element, 'cropstart', {\n      originalEvent: e,\n      action: action\n    }) === false) {\n      return;\n    }\n\n    e.preventDefault();\n\n    self.action = action;\n    self.cropping = false;\n\n    if (action === 'crop') {\n      self.cropping = true;\n      addClass(self.dragBox, 'cropper-modal');\n    }\n  },\n  cropMove: function cropMove(event) {\n    var self = this;\n    var action = self.action;\n\n    if (self.disabled || !action) {\n      return;\n    }\n\n    var pointers = self.pointers;\n    var e = getEvent(event);\n\n    e.preventDefault();\n\n    if (dispatchEvent(self.element, 'cropmove', {\n      originalEvent: e,\n      action: action\n    }) === false) {\n      return;\n    }\n\n    if (e.changedTouches) {\n      each(e.changedTouches, function (touch) {\n        extend(pointers[touch.identifier], getPointer(touch, true));\n      });\n    } else {\n      extend(pointers[e.pointerId || 0], getPointer(e, true));\n    }\n\n    self.change(e);\n  },\n  cropEnd: function cropEnd(event) {\n    var self = this;\n\n    if (self.disabled) {\n      return;\n    }\n\n    var action = self.action;\n    var pointers = self.pointers;\n    var e = getEvent(event);\n\n    if (e.changedTouches) {\n      each(e.changedTouches, function (touch) {\n        delete pointers[touch.identifier];\n      });\n    } else {\n      delete pointers[e.pointerId || 0];\n    }\n\n    if (!action) {\n      return;\n    }\n\n    e.preventDefault();\n\n    if (!Object.keys(pointers).length) {\n      self.action = '';\n    }\n\n    if (self.cropping) {\n      self.cropping = false;\n      toggleClass(self.dragBox, 'cropper-modal', self.cropped && this.options.modal);\n    }\n\n    dispatchEvent(self.element, 'cropend', {\n      originalEvent: e,\n      action: action\n    });\n  }\n};\n\n// Actions\nvar ACTION_EAST = 'e';\nvar ACTION_WEST = 'w';\nvar ACTION_SOUTH = 's';\nvar ACTION_NORTH = 'n';\nvar ACTION_SOUTH_EAST = 'se';\nvar ACTION_SOUTH_WEST = 'sw';\nvar ACTION_NORTH_EAST = 'ne';\nvar ACTION_NORTH_WEST = 'nw';\n\nfunction getMaxZoomRatio(pointers) {\n  var pointers2 = extend({}, pointers);\n  var ratios = [];\n\n  each(pointers, function (pointer, pointerId) {\n    delete pointers2[pointerId];\n\n    each(pointers2, function (pointer2) {\n      var x1 = Math.abs(pointer.startX - pointer2.startX);\n      var y1 = Math.abs(pointer.startY - pointer2.startY);\n      var x2 = Math.abs(pointer.endX - pointer2.endX);\n      var y2 = Math.abs(pointer.endY - pointer2.endY);\n      var z1 = Math.sqrt(x1 * x1 + y1 * y1);\n      var z2 = Math.sqrt(x2 * x2 + y2 * y2);\n      var ratio = (z2 - z1) / z1;\n\n      ratios.push(ratio);\n    });\n  });\n\n  ratios.sort(function (a, b) {\n    return Math.abs(a) < Math.abs(b);\n  });\n\n  return ratios[0];\n}\n\nvar change$1 = {\n  change: function change(e) {\n    var self = this;\n    var options = self.options;\n    var containerData = self.containerData;\n    var canvasData = self.canvasData;\n    var cropBoxData = self.cropBoxData;\n    var aspectRatio = options.aspectRatio;\n    var action = self.action;\n    var width = cropBoxData.width;\n    var height = cropBoxData.height;\n    var left = cropBoxData.left;\n    var top = cropBoxData.top;\n    var right = left + width;\n    var bottom = top + height;\n    var minLeft = 0;\n    var minTop = 0;\n    var maxWidth = containerData.width;\n    var maxHeight = containerData.height;\n    var renderable = true;\n    var offset = void 0;\n\n    // Locking aspect ratio in \"free mode\" by holding shift key\n    if (!aspectRatio && e.shiftKey) {\n      aspectRatio = width && height ? width / height : 1;\n    }\n\n    if (self.limited) {\n      minLeft = cropBoxData.minLeft;\n      minTop = cropBoxData.minTop;\n      maxWidth = minLeft + Math.min(containerData.width, canvasData.width, canvasData.left + canvasData.width);\n      maxHeight = minTop + Math.min(containerData.height, canvasData.height, canvasData.top + canvasData.height);\n    }\n\n    var pointers = self.pointers;\n    var pointer = pointers[Object.keys(pointers)[0]];\n    var range = {\n      x: pointer.endX - pointer.startX,\n      y: pointer.endY - pointer.startY\n    };\n\n    if (aspectRatio) {\n      range.X = range.y * aspectRatio;\n      range.Y = range.x / aspectRatio;\n    }\n\n    switch (action) {\n      // Move crop box\n      case 'all':\n        left += range.x;\n        top += range.y;\n        break;\n\n      // Resize crop box\n      case ACTION_EAST:\n        if (range.x >= 0 && (right >= maxWidth || aspectRatio && (top <= minTop || bottom >= maxHeight))) {\n          renderable = false;\n          break;\n        }\n\n        width += range.x;\n\n        if (aspectRatio) {\n          height = width / aspectRatio;\n          top -= range.Y / 2;\n        }\n\n        if (width < 0) {\n          action = ACTION_WEST;\n          width = 0;\n        }\n\n        break;\n\n      case ACTION_NORTH:\n        if (range.y <= 0 && (top <= minTop || aspectRatio && (left <= minLeft || right >= maxWidth))) {\n          renderable = false;\n          break;\n        }\n\n        height -= range.y;\n        top += range.y;\n\n        if (aspectRatio) {\n          width = height * aspectRatio;\n          left += range.X / 2;\n        }\n\n        if (height < 0) {\n          action = ACTION_SOUTH;\n          height = 0;\n        }\n\n        break;\n\n      case ACTION_WEST:\n        if (range.x <= 0 && (left <= minLeft || aspectRatio && (top <= minTop || bottom >= maxHeight))) {\n          renderable = false;\n          break;\n        }\n\n        width -= range.x;\n        left += range.x;\n\n        if (aspectRatio) {\n          height = width / aspectRatio;\n          top += range.Y / 2;\n        }\n\n        if (width < 0) {\n          action = ACTION_EAST;\n          width = 0;\n        }\n\n        break;\n\n      case ACTION_SOUTH:\n        if (range.y >= 0 && (bottom >= maxHeight || aspectRatio && (left <= minLeft || right >= maxWidth))) {\n          renderable = false;\n          break;\n        }\n\n        height += range.y;\n\n        if (aspectRatio) {\n          width = height * aspectRatio;\n          left -= range.X / 2;\n        }\n\n        if (height < 0) {\n          action = ACTION_NORTH;\n          height = 0;\n        }\n\n        break;\n\n      case ACTION_NORTH_EAST:\n        if (aspectRatio) {\n          if (range.y <= 0 && (top <= minTop || right >= maxWidth)) {\n            renderable = false;\n            break;\n          }\n\n          height -= range.y;\n          top += range.y;\n          width = height * aspectRatio;\n        } else {\n          if (range.x >= 0) {\n            if (right < maxWidth) {\n              width += range.x;\n            } else if (range.y <= 0 && top <= minTop) {\n              renderable = false;\n            }\n          } else {\n            width += range.x;\n          }\n\n          if (range.y <= 0) {\n            if (top > minTop) {\n              height -= range.y;\n              top += range.y;\n            }\n          } else {\n            height -= range.y;\n            top += range.y;\n          }\n        }\n\n        if (width < 0 && height < 0) {\n          action = ACTION_SOUTH_WEST;\n          height = 0;\n          width = 0;\n        } else if (width < 0) {\n          action = ACTION_NORTH_WEST;\n          width = 0;\n        } else if (height < 0) {\n          action = ACTION_SOUTH_EAST;\n          height = 0;\n        }\n\n        break;\n\n      case ACTION_NORTH_WEST:\n        if (aspectRatio) {\n          if (range.y <= 0 && (top <= minTop || left <= minLeft)) {\n            renderable = false;\n            break;\n          }\n\n          height -= range.y;\n          top += range.y;\n          width = height * aspectRatio;\n          left += range.X;\n        } else {\n          if (range.x <= 0) {\n            if (left > minLeft) {\n              width -= range.x;\n              left += range.x;\n            } else if (range.y <= 0 && top <= minTop) {\n              renderable = false;\n            }\n          } else {\n            width -= range.x;\n            left += range.x;\n          }\n\n          if (range.y <= 0) {\n            if (top > minTop) {\n              height -= range.y;\n              top += range.y;\n            }\n          } else {\n            height -= range.y;\n            top += range.y;\n          }\n        }\n\n        if (width < 0 && height < 0) {\n          action = ACTION_SOUTH_EAST;\n          height = 0;\n          width = 0;\n        } else if (width < 0) {\n          action = ACTION_NORTH_EAST;\n          width = 0;\n        } else if (height < 0) {\n          action = ACTION_SOUTH_WEST;\n          height = 0;\n        }\n\n        break;\n\n      case ACTION_SOUTH_WEST:\n        if (aspectRatio) {\n          if (range.x <= 0 && (left <= minLeft || bottom >= maxHeight)) {\n            renderable = false;\n            break;\n          }\n\n          width -= range.x;\n          left += range.x;\n          height = width / aspectRatio;\n        } else {\n          if (range.x <= 0) {\n            if (left > minLeft) {\n              width -= range.x;\n              left += range.x;\n            } else if (range.y >= 0 && bottom >= maxHeight) {\n              renderable = false;\n            }\n          } else {\n            width -= range.x;\n            left += range.x;\n          }\n\n          if (range.y >= 0) {\n            if (bottom < maxHeight) {\n              height += range.y;\n            }\n          } else {\n            height += range.y;\n          }\n        }\n\n        if (width < 0 && height < 0) {\n          action = ACTION_NORTH_EAST;\n          height = 0;\n          width = 0;\n        } else if (width < 0) {\n          action = ACTION_SOUTH_EAST;\n          width = 0;\n        } else if (height < 0) {\n          action = ACTION_NORTH_WEST;\n          height = 0;\n        }\n\n        break;\n\n      case ACTION_SOUTH_EAST:\n        if (aspectRatio) {\n          if (range.x >= 0 && (right >= maxWidth || bottom >= maxHeight)) {\n            renderable = false;\n            break;\n          }\n\n          width += range.x;\n          height = width / aspectRatio;\n        } else {\n          if (range.x >= 0) {\n            if (right < maxWidth) {\n              width += range.x;\n            } else if (range.y >= 0 && bottom >= maxHeight) {\n              renderable = false;\n            }\n          } else {\n            width += range.x;\n          }\n\n          if (range.y >= 0) {\n            if (bottom < maxHeight) {\n              height += range.y;\n            }\n          } else {\n            height += range.y;\n          }\n        }\n\n        if (width < 0 && height < 0) {\n          action = ACTION_NORTH_WEST;\n          height = 0;\n          width = 0;\n        } else if (width < 0) {\n          action = ACTION_SOUTH_WEST;\n          width = 0;\n        } else if (height < 0) {\n          action = ACTION_NORTH_EAST;\n          height = 0;\n        }\n\n        break;\n\n      // Move canvas\n      case 'move':\n        self.move(range.x, range.y);\n        renderable = false;\n        break;\n\n      // Zoom canvas\n      case 'zoom':\n        self.zoom(getMaxZoomRatio(pointers), e);\n        renderable = false;\n        break;\n\n      // Create crop box\n      case 'crop':\n        if (!range.x || !range.y) {\n          renderable = false;\n          break;\n        }\n\n        offset = getOffset(self.cropper);\n        left = pointer.startX - offset.left;\n        top = pointer.startY - offset.top;\n        width = cropBoxData.minWidth;\n        height = cropBoxData.minHeight;\n\n        if (range.x > 0) {\n          action = range.y > 0 ? ACTION_SOUTH_EAST : ACTION_NORTH_EAST;\n        } else if (range.x < 0) {\n          left -= width;\n          action = range.y > 0 ? ACTION_SOUTH_WEST : ACTION_NORTH_WEST;\n        }\n\n        if (range.y < 0) {\n          top -= height;\n        }\n\n        // Show the crop box if is hidden\n        if (!self.cropped) {\n          removeClass(self.cropBox, 'cropper-hidden');\n          self.cropped = true;\n\n          if (self.limited) {\n            self.limitCropBox(true, true);\n          }\n        }\n\n        break;\n\n      // No default\n    }\n\n    if (renderable) {\n      cropBoxData.width = width;\n      cropBoxData.height = height;\n      cropBoxData.left = left;\n      cropBoxData.top = top;\n      self.action = action;\n\n      self.renderCropBox();\n    }\n\n    // Override\n    each(pointers, function (p) {\n      p.startX = p.endX;\n      p.startY = p.endY;\n    });\n  }\n};\n\nfunction getPointersCenter(pointers) {\n  var pageX = 0;\n  var pageY = 0;\n  var count = 0;\n\n  each(pointers, function (_ref) {\n    var startX = _ref.startX,\n        startY = _ref.startY;\n\n    pageX += startX;\n    pageY += startY;\n    count += 1;\n  });\n\n  pageX /= count;\n  pageY /= count;\n\n  return {\n    pageX: pageX,\n    pageY: pageY\n  };\n}\n\nvar methods = {\n  // Show the crop box manually\n  crop: function crop() {\n    var self = this;\n\n    if (self.ready && !self.disabled) {\n      if (!self.cropped) {\n        self.cropped = true;\n        self.limitCropBox(true, true);\n\n        if (self.options.modal) {\n          addClass(self.dragBox, 'cropper-modal');\n        }\n\n        removeClass(self.cropBox, 'cropper-hidden');\n      }\n\n      self.setCropBoxData(self.initialCropBoxData);\n    }\n\n    return self;\n  },\n\n\n  // Reset the image and crop box to their initial states\n  reset: function reset() {\n    var self = this;\n\n    if (self.ready && !self.disabled) {\n      self.imageData = extend({}, self.initialImageData);\n      self.canvasData = extend({}, self.initialCanvasData);\n      self.cropBoxData = extend({}, self.initialCropBoxData);\n\n      self.renderCanvas();\n\n      if (self.cropped) {\n        self.renderCropBox();\n      }\n    }\n\n    return self;\n  },\n\n\n  // Clear the crop box\n  clear: function clear() {\n    var self = this;\n\n    if (self.cropped && !self.disabled) {\n      extend(self.cropBoxData, {\n        left: 0,\n        top: 0,\n        width: 0,\n        height: 0\n      });\n\n      self.cropped = false;\n      self.renderCropBox();\n\n      self.limitCanvas();\n\n      // Render canvas after crop box rendered\n      self.renderCanvas();\n\n      removeClass(self.dragBox, 'cropper-modal');\n      addClass(self.cropBox, 'cropper-hidden');\n    }\n\n    return self;\n  },\n\n\n  /**\n   * Replace the image's src and rebuild the cropper\n   *\n   * @param {String} url\n   * @param {Boolean} onlyColorChanged (optional)\n   */\n  replace: function replace(url, onlyColorChanged) {\n    var self = this;\n\n    if (!self.disabled && url) {\n      if (self.isImg) {\n        self.element.src = url;\n      }\n\n      if (onlyColorChanged) {\n        self.url = url;\n        self.image.src = url;\n\n        if (self.ready) {\n          self.image2.src = url;\n\n          each(self.previews, function (element) {\n            getByTag(element, 'img')[0].src = url;\n          });\n        }\n      } else {\n        if (self.isImg) {\n          self.replaced = true;\n        }\n\n        // Clear previous data\n        self.options.data = null;\n        self.load(url);\n      }\n    }\n\n    return self;\n  },\n\n\n  // Enable (unfreeze) the cropper\n  enable: function enable() {\n    var self = this;\n\n    if (self.ready) {\n      self.disabled = false;\n      removeClass(self.cropper, 'cropper-disabled');\n    }\n\n    return self;\n  },\n\n\n  // Disable (freeze) the cropper\n  disable: function disable() {\n    var self = this;\n\n    if (self.ready) {\n      self.disabled = true;\n      addClass(self.cropper, 'cropper-disabled');\n    }\n\n    return self;\n  },\n\n\n  // Destroy the cropper and remove the instance from the image\n  destroy: function destroy() {\n    var self = this;\n    var element = self.element;\n    var image = self.image;\n\n    if (self.loaded) {\n      if (self.isImg && self.replaced) {\n        element.src = self.originalUrl;\n      }\n\n      self.unbuild();\n      removeClass(element, 'cropper-hidden');\n    } else if (self.isImg) {\n      removeListener(element, 'load', self.onStart);\n    } else if (image) {\n      removeChild(image);\n    }\n\n    removeData(element, 'cropper');\n\n    return self;\n  },\n\n\n  /**\n   * Move the canvas with relative offsets\n   *\n   * @param {Number} offsetX\n   * @param {Number} offsetY (optional)\n   */\n  move: function move(offsetX, offsetY) {\n    var self = this;\n    var canvasData = self.canvasData;\n\n    return self.moveTo(isUndefined(offsetX) ? offsetX : canvasData.left + Number(offsetX), isUndefined(offsetY) ? offsetY : canvasData.top + Number(offsetY));\n  },\n\n\n  /**\n   * Move the canvas to an absolute point\n   *\n   * @param {Number} x\n   * @param {Number} y (optional)\n   */\n  moveTo: function moveTo(x, y) {\n    var self = this;\n    var canvasData = self.canvasData;\n    var changed = false;\n\n    // If \"y\" is not present, its default value is \"x\"\n    if (isUndefined(y)) {\n      y = x;\n    }\n\n    x = Number(x);\n    y = Number(y);\n\n    if (self.ready && !self.disabled && self.options.movable) {\n      if (isNumber(x)) {\n        canvasData.left = x;\n        changed = true;\n      }\n\n      if (isNumber(y)) {\n        canvasData.top = y;\n        changed = true;\n      }\n\n      if (changed) {\n        self.renderCanvas(true);\n      }\n    }\n\n    return self;\n  },\n\n\n  /**\n   * Zoom the canvas with a relative ratio\n   *\n   * @param {Number} ratio\n   * @param {Event} _originalEvent (private)\n   */\n  zoom: function zoom(ratio, _originalEvent) {\n    var self = this;\n    var canvasData = self.canvasData;\n\n    ratio = Number(ratio);\n\n    if (ratio < 0) {\n      ratio = 1 / (1 - ratio);\n    } else {\n      ratio = 1 + ratio;\n    }\n\n    return self.zoomTo(canvasData.width * ratio / canvasData.naturalWidth, _originalEvent);\n  },\n\n\n  /**\n   * Zoom the canvas to an absolute ratio\n   *\n   * @param {Number} ratio\n   * @param {Event} _originalEvent (private)\n   */\n  zoomTo: function zoomTo(ratio, _originalEvent) {\n    var self = this;\n    var options = self.options;\n    var canvasData = self.canvasData;\n    var width = canvasData.width;\n    var height = canvasData.height;\n    var naturalWidth = canvasData.naturalWidth;\n    var naturalHeight = canvasData.naturalHeight;\n\n    ratio = Number(ratio);\n\n    if (ratio >= 0 && self.ready && !self.disabled && options.zoomable) {\n      var newWidth = naturalWidth * ratio;\n      var newHeight = naturalHeight * ratio;\n\n      if (dispatchEvent(self.element, 'zoom', {\n        originalEvent: _originalEvent,\n        oldRatio: width / naturalWidth,\n        ratio: newWidth / naturalWidth\n      }) === false) {\n        return self;\n      }\n\n      if (_originalEvent) {\n        var pointers = self.pointers;\n        var offset = getOffset(self.cropper);\n        var center = pointers && Object.keys(pointers).length ? getPointersCenter(pointers) : {\n          pageX: _originalEvent.pageX,\n          pageY: _originalEvent.pageY\n        };\n\n        // Zoom from the triggering point of the event\n        canvasData.left -= (newWidth - width) * ((center.pageX - offset.left - canvasData.left) / width);\n        canvasData.top -= (newHeight - height) * ((center.pageY - offset.top - canvasData.top) / height);\n      } else {\n        // Zoom from the center of the canvas\n        canvasData.left -= (newWidth - width) / 2;\n        canvasData.top -= (newHeight - height) / 2;\n      }\n\n      canvasData.width = newWidth;\n      canvasData.height = newHeight;\n      self.renderCanvas(true);\n    }\n\n    return self;\n  },\n\n\n  /**\n   * Rotate the canvas with a relative degree\n   *\n   * @param {Number} degree\n   */\n  rotate: function rotate(degree) {\n    var self = this;\n\n    return self.rotateTo((self.imageData.rotate || 0) + Number(degree));\n  },\n\n\n  /**\n   * Rotate the canvas to an absolute degree\n   * https://developer.mozilla.org/en-US/docs/Web/CSS/transform-function#rotate()\n   *\n   * @param {Number} degree\n   */\n  rotateTo: function rotateTo(degree) {\n    var self = this;\n\n    degree = Number(degree);\n\n    if (isNumber(degree) && self.ready && !self.disabled && self.options.rotatable) {\n      self.imageData.rotate = degree % 360;\n      self.rotated = true;\n      self.renderCanvas(true);\n    }\n\n    return self;\n  },\n\n\n  /**\n   * Scale the image\n   * https://developer.mozilla.org/en-US/docs/Web/CSS/transform-function#scale()\n   *\n   * @param {Number} scaleX\n   * @param {Number} scaleY (optional)\n   */\n  scale: function scale(scaleX, scaleY) {\n    var self = this;\n    var imageData = self.imageData;\n    var changed = false;\n\n    // If \"scaleY\" is not present, its default value is \"scaleX\"\n    if (isUndefined(scaleY)) {\n      scaleY = scaleX;\n    }\n\n    scaleX = Number(scaleX);\n    scaleY = Number(scaleY);\n\n    if (self.ready && !self.disabled && self.options.scalable) {\n      if (isNumber(scaleX)) {\n        imageData.scaleX = scaleX;\n        changed = true;\n      }\n\n      if (isNumber(scaleY)) {\n        imageData.scaleY = scaleY;\n        changed = true;\n      }\n\n      if (changed) {\n        self.renderImage(true);\n      }\n    }\n\n    return self;\n  },\n\n\n  /**\n   * Scale the abscissa of the image\n   *\n   * @param {Number} scaleX\n   */\n  scaleX: function scaleX(_scaleX) {\n    var self = this;\n    var scaleY = self.imageData.scaleY;\n\n    return self.scale(_scaleX, isNumber(scaleY) ? scaleY : 1);\n  },\n\n\n  /**\n   * Scale the ordinate of the image\n   *\n   * @param {Number} scaleY\n   */\n  scaleY: function scaleY(_scaleY) {\n    var self = this;\n    var scaleX = self.imageData.scaleX;\n\n    return self.scale(isNumber(scaleX) ? scaleX : 1, _scaleY);\n  },\n\n\n  /**\n   * Get the cropped area position and size data (base on the original image)\n   *\n   * @param {Boolean} rounded (optional)\n   * @return {Object} data\n   */\n  getData: function getData(rounded) {\n    var self = this;\n    var options = self.options;\n    var imageData = self.imageData;\n    var canvasData = self.canvasData;\n    var cropBoxData = self.cropBoxData;\n    var ratio = void 0;\n    var data = void 0;\n\n    if (self.ready && self.cropped) {\n      data = {\n        x: cropBoxData.left - canvasData.left,\n        y: cropBoxData.top - canvasData.top,\n        width: cropBoxData.width,\n        height: cropBoxData.height\n      };\n\n      ratio = imageData.width / imageData.naturalWidth;\n\n      each(data, function (n, i) {\n        n /= ratio;\n        data[i] = rounded ? Math.round(n) : n;\n      });\n    } else {\n      data = {\n        x: 0,\n        y: 0,\n        width: 0,\n        height: 0\n      };\n    }\n\n    if (options.rotatable) {\n      data.rotate = imageData.rotate || 0;\n    }\n\n    if (options.scalable) {\n      data.scaleX = imageData.scaleX || 1;\n      data.scaleY = imageData.scaleY || 1;\n    }\n\n    return data;\n  },\n\n\n  /**\n   * Set the cropped area position and size with new data\n   *\n   * @param {Object} data\n   */\n  setData: function setData(data) {\n    var self = this;\n    var options = self.options;\n    var imageData = self.imageData;\n    var canvasData = self.canvasData;\n    var cropBoxData = {};\n    var rotated = void 0;\n    var scaled = void 0;\n    var ratio = void 0;\n\n    if (isFunction(data)) {\n      data = data.call(self.element);\n    }\n\n    if (self.ready && !self.disabled && isPlainObject(data)) {\n      if (options.rotatable) {\n        if (isNumber(data.rotate) && data.rotate !== imageData.rotate) {\n          imageData.rotate = data.rotate;\n          self.rotated = rotated = true;\n        }\n      }\n\n      if (options.scalable) {\n        if (isNumber(data.scaleX) && data.scaleX !== imageData.scaleX) {\n          imageData.scaleX = data.scaleX;\n          scaled = true;\n        }\n\n        if (isNumber(data.scaleY) && data.scaleY !== imageData.scaleY) {\n          imageData.scaleY = data.scaleY;\n          scaled = true;\n        }\n      }\n\n      if (rotated) {\n        self.renderCanvas();\n      } else if (scaled) {\n        self.renderImage();\n      }\n\n      ratio = imageData.width / imageData.naturalWidth;\n\n      if (isNumber(data.x)) {\n        cropBoxData.left = data.x * ratio + canvasData.left;\n      }\n\n      if (isNumber(data.y)) {\n        cropBoxData.top = data.y * ratio + canvasData.top;\n      }\n\n      if (isNumber(data.width)) {\n        cropBoxData.width = data.width * ratio;\n      }\n\n      if (isNumber(data.height)) {\n        cropBoxData.height = data.height * ratio;\n      }\n\n      self.setCropBoxData(cropBoxData);\n    }\n\n    return self;\n  },\n\n\n  /**\n   * Get the container size data\n   *\n   * @return {Object} data\n   */\n  getContainerData: function getContainerData() {\n    var self = this;\n\n    return self.ready ? self.containerData : {};\n  },\n\n\n  /**\n   * Get the image position and size data\n   *\n   * @return {Object} data\n   */\n  getImageData: function getImageData() {\n    var self = this;\n\n    return self.loaded ? self.imageData : {};\n  },\n\n\n  /**\n   * Get the canvas position and size data\n   *\n   * @return {Object} data\n   */\n  getCanvasData: function getCanvasData() {\n    var self = this;\n    var canvasData = self.canvasData;\n    var data = {};\n\n    if (self.ready) {\n      each(['left', 'top', 'width', 'height', 'naturalWidth', 'naturalHeight'], function (n) {\n        data[n] = canvasData[n];\n      });\n    }\n\n    return data;\n  },\n\n\n  /**\n   * Set the canvas position and size with new data\n   *\n   * @param {Object} data\n   */\n  setCanvasData: function setCanvasData(data) {\n    var self = this;\n    var canvasData = self.canvasData;\n    var aspectRatio = canvasData.aspectRatio;\n\n    if (isFunction(data)) {\n      data = data.call(self.element);\n    }\n\n    if (self.ready && !self.disabled && isPlainObject(data)) {\n      if (isNumber(data.left)) {\n        canvasData.left = data.left;\n      }\n\n      if (isNumber(data.top)) {\n        canvasData.top = data.top;\n      }\n\n      if (isNumber(data.width)) {\n        canvasData.width = data.width;\n        canvasData.height = data.width / aspectRatio;\n      } else if (isNumber(data.height)) {\n        canvasData.height = data.height;\n        canvasData.width = data.height * aspectRatio;\n      }\n\n      self.renderCanvas(true);\n    }\n\n    return self;\n  },\n\n\n  /**\n   * Get the crop box position and size data\n   *\n   * @return {Object} data\n   */\n  getCropBoxData: function getCropBoxData() {\n    var self = this;\n    var cropBoxData = self.cropBoxData;\n    var data = void 0;\n\n    if (self.ready && self.cropped) {\n      data = {\n        left: cropBoxData.left,\n        top: cropBoxData.top,\n        width: cropBoxData.width,\n        height: cropBoxData.height\n      };\n    }\n\n    return data || {};\n  },\n\n\n  /**\n   * Set the crop box position and size with new data\n   *\n   * @param {Object} data\n   */\n  setCropBoxData: function setCropBoxData(data) {\n    var self = this;\n    var cropBoxData = self.cropBoxData;\n    var aspectRatio = self.options.aspectRatio;\n    var widthChanged = void 0;\n    var heightChanged = void 0;\n\n    if (isFunction(data)) {\n      data = data.call(self.element);\n    }\n\n    if (self.ready && self.cropped && !self.disabled && isPlainObject(data)) {\n      if (isNumber(data.left)) {\n        cropBoxData.left = data.left;\n      }\n\n      if (isNumber(data.top)) {\n        cropBoxData.top = data.top;\n      }\n\n      if (isNumber(data.width) && data.width !== cropBoxData.width) {\n        widthChanged = true;\n        cropBoxData.width = data.width;\n      }\n\n      if (isNumber(data.height) && data.height !== cropBoxData.height) {\n        heightChanged = true;\n        cropBoxData.height = data.height;\n      }\n\n      if (aspectRatio) {\n        if (widthChanged) {\n          cropBoxData.height = cropBoxData.width / aspectRatio;\n        } else if (heightChanged) {\n          cropBoxData.width = cropBoxData.height * aspectRatio;\n        }\n      }\n\n      self.renderCropBox();\n    }\n\n    return self;\n  },\n\n\n  /**\n   * Get a canvas drawn the cropped image\n   *\n   * @param {Object} options (optional)\n   * @return {HTMLCanvasElement} canvas\n   */\n  getCroppedCanvas: function getCroppedCanvas(options) {\n    var self = this;\n\n    if (!self.ready || !window.HTMLCanvasElement) {\n      return null;\n    }\n\n    if (!isPlainObject(options)) {\n      options = {};\n    }\n\n    // Return the whole canvas if not cropped\n    if (!self.cropped) {\n      return getSourceCanvas(self.image, self.imageData, options);\n    }\n\n    var data = self.getData();\n    var originalWidth = data.width;\n    var originalHeight = data.height;\n    var aspectRatio = originalWidth / originalHeight;\n    var scaledWidth = void 0;\n    var scaledHeight = void 0;\n    var scaledRatio = void 0;\n\n    if (isPlainObject(options)) {\n      scaledWidth = options.width;\n      scaledHeight = options.height;\n\n      if (scaledWidth) {\n        scaledHeight = scaledWidth / aspectRatio;\n        scaledRatio = scaledWidth / originalWidth;\n      } else if (scaledHeight) {\n        scaledWidth = scaledHeight * aspectRatio;\n        scaledRatio = scaledHeight / originalHeight;\n      }\n    }\n\n    // The canvas element will use `Math.floor` on a float number, so floor first\n    var canvasWidth = Math.floor(scaledWidth || originalWidth);\n    var canvasHeight = Math.floor(scaledHeight || originalHeight);\n\n    var canvas = createElement('canvas');\n    var context = canvas.getContext('2d');\n\n    canvas.width = canvasWidth;\n    canvas.height = canvasHeight;\n\n    if (options.fillColor) {\n      context.fillStyle = options.fillColor;\n      context.fillRect(0, 0, canvasWidth, canvasHeight);\n    }\n\n    // https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D.drawImage\n    var parameters = function () {\n      var source = getSourceCanvas(self.image, self.imageData, options);\n      var sourceWidth = source.width;\n      var sourceHeight = source.height;\n      var canvasData = self.canvasData;\n      var params = [source];\n\n      // Source canvas\n      var srcX = data.x + canvasData.naturalWidth * (Math.abs(data.scaleX || 1) - 1) / 2;\n      var srcY = data.y + canvasData.naturalHeight * (Math.abs(data.scaleY || 1) - 1) / 2;\n      var srcWidth = void 0;\n      var srcHeight = void 0;\n\n      // Destination canvas\n      var dstX = void 0;\n      var dstY = void 0;\n      var dstWidth = void 0;\n      var dstHeight = void 0;\n\n      if (srcX <= -originalWidth || srcX > sourceWidth) {\n        srcX = srcWidth = dstX = dstWidth = 0;\n      } else if (srcX <= 0) {\n        dstX = -srcX;\n        srcX = 0;\n        srcWidth = dstWidth = Math.min(sourceWidth, originalWidth + srcX);\n      } else if (srcX <= sourceWidth) {\n        dstX = 0;\n        srcWidth = dstWidth = Math.min(originalWidth, sourceWidth - srcX);\n      }\n\n      if (srcWidth <= 0 || srcY <= -originalHeight || srcY > sourceHeight) {\n        srcY = srcHeight = dstY = dstHeight = 0;\n      } else if (srcY <= 0) {\n        dstY = -srcY;\n        srcY = 0;\n        srcHeight = dstHeight = Math.min(sourceHeight, originalHeight + srcY);\n      } else if (srcY <= sourceHeight) {\n        dstY = 0;\n        srcHeight = dstHeight = Math.min(originalHeight, sourceHeight - srcY);\n      }\n\n      params.push(Math.floor(srcX), Math.floor(srcY), Math.floor(srcWidth), Math.floor(srcHeight));\n\n      // Scale destination sizes\n      if (scaledRatio) {\n        dstX *= scaledRatio;\n        dstY *= scaledRatio;\n        dstWidth *= scaledRatio;\n        dstHeight *= scaledRatio;\n      }\n\n      // Avoid \"IndexSizeError\" in IE and Firefox\n      if (dstWidth > 0 && dstHeight > 0) {\n        params.push(Math.floor(dstX), Math.floor(dstY), Math.floor(dstWidth), Math.floor(dstHeight));\n      }\n\n      return params;\n    }();\n\n    context.imageSmoothingEnabled = !!options.imageSmoothingEnabled;\n\n    if (options.imageSmoothingQuality) {\n      context.imageSmoothingQuality = options.imageSmoothingQuality;\n    }\n\n    context.drawImage.apply(context, toConsumableArray(parameters));\n\n    return canvas;\n  },\n\n\n  /**\n   * Change the aspect ratio of the crop box\n   *\n   * @param {Number} aspectRatio\n   */\n  setAspectRatio: function setAspectRatio(aspectRatio) {\n    var self = this;\n    var options = self.options;\n\n    if (!self.disabled && !isUndefined(aspectRatio)) {\n      // 0 -> NaN\n      options.aspectRatio = Math.max(0, aspectRatio) || NaN;\n\n      if (self.ready) {\n        self.initCropBox();\n\n        if (self.cropped) {\n          self.renderCropBox();\n        }\n      }\n    }\n\n    return self;\n  },\n\n\n  /**\n   * Change the drag mode\n   *\n   * @param {String} mode (optional)\n   */\n  setDragMode: function setDragMode(mode) {\n    var self = this;\n    var options = self.options;\n    var dragBox = self.dragBox;\n    var face = self.face;\n    var croppable = void 0;\n    var movable = void 0;\n\n    if (self.loaded && !self.disabled) {\n      croppable = mode === 'crop';\n      movable = options.movable && mode === 'move';\n      mode = croppable || movable ? mode : 'none';\n\n      setData$1(dragBox, 'action', mode);\n      toggleClass(dragBox, 'cropper-crop', croppable);\n      toggleClass(dragBox, 'cropper-move', movable);\n\n      if (!options.cropBoxMovable) {\n        // Sync drag mode to crop box when it is not movable\n        setData$1(face, 'action', mode);\n        toggleClass(face, 'cropper-crop', croppable);\n        toggleClass(face, 'cropper-move', movable);\n      }\n    }\n\n    return self;\n  }\n};\n\n// Constants\nvar NAMESPACE = 'cropper';\n\n// Classes\nvar CLASS_HIDDEN = NAMESPACE + '-hidden';\n\n// Events\nvar EVENT_ERROR = 'error';\nvar EVENT_LOAD = 'load';\nvar EVENT_READY = 'ready';\nvar EVENT_CROP = 'crop';\n\n// RegExps\nvar REGEXP_DATA_URL = /^data:/;\nvar REGEXP_DATA_URL_JPEG = /^data:image\\/jpeg;base64,/;\n\nvar AnotherCropper = void 0;\n\nvar Cropper = function () {\n  function Cropper(element, options) {\n    classCallCheck(this, Cropper);\n\n    var self = this;\n\n    self.element = element;\n    self.options = extend({}, DEFAULTS, isPlainObject(options) && options);\n    self.loaded = false;\n    self.ready = false;\n    self.complete = false;\n    self.rotated = false;\n    self.cropped = false;\n    self.disabled = false;\n    self.replaced = false;\n    self.limited = false;\n    self.wheeling = false;\n    self.isImg = false;\n    self.originalUrl = '';\n    self.canvasData = null;\n    self.cropBoxData = null;\n    self.previews = null;\n    self.pointers = {};\n    self.init();\n  }\n\n  createClass(Cropper, [{\n    key: 'init',\n    value: function init() {\n      var self = this;\n      var element = self.element;\n      var tagName = element.tagName.toLowerCase();\n      var url = void 0;\n\n      if (getData$1(element, NAMESPACE)) {\n        return;\n      }\n\n      setData$1(element, NAMESPACE, self);\n\n      if (tagName === 'img') {\n        self.isImg = true;\n\n        // e.g.: \"img/picture.jpg\"\n        self.originalUrl = url = element.getAttribute('src');\n\n        // Stop when it's a blank image\n        if (!url) {\n          return;\n        }\n\n        // e.g.: \"http://example.com/img/picture.jpg\"\n        url = element.src;\n      } else if (tagName === 'canvas' && window.HTMLCanvasElement) {\n        url = element.toDataURL();\n      }\n\n      self.load(url);\n    }\n  }, {\n    key: 'load',\n    value: function load(url) {\n      var self = this;\n      var options = self.options;\n      var element = self.element;\n\n      if (!url) {\n        return;\n      }\n\n      self.url = url;\n      self.imageData = {};\n\n      if (!options.checkOrientation || !window.ArrayBuffer) {\n        self.clone();\n        return;\n      }\n\n      // XMLHttpRequest disallows to open a Data URL in some browsers like IE11 and Safari\n      if (REGEXP_DATA_URL.test(url)) {\n        if (REGEXP_DATA_URL_JPEG.test(url)) {\n          self.read(dataURLToArrayBuffer(url));\n        } else {\n          self.clone();\n        }\n        return;\n      }\n\n      var xhr = new XMLHttpRequest();\n\n      xhr.onerror = xhr.onabort = function () {\n        self.clone();\n      };\n\n      xhr.onload = function () {\n        self.read(xhr.response);\n      };\n\n      if (options.checkCrossOrigin && isCrossOriginURL(url) && element.crossOrigin) {\n        url = addTimestamp(url);\n      }\n\n      xhr.open('get', url);\n      xhr.responseType = 'arraybuffer';\n      xhr.withCredentials = element.crossOrigin === 'use-credentials';\n      xhr.send();\n    }\n  }, {\n    key: 'read',\n    value: function read(arrayBuffer) {\n      var self = this;\n      var options = self.options;\n      var orientation = getOrientation(arrayBuffer);\n      var imageData = self.imageData;\n      var rotate = 0;\n      var scaleX = 1;\n      var scaleY = 1;\n\n      if (orientation > 1) {\n        self.url = arrayBufferToDataURL(arrayBuffer);\n\n        switch (orientation) {\n\n          // flip horizontal\n          case 2:\n            scaleX = -1;\n            break;\n\n          // rotate left 180°\n          case 3:\n            rotate = -180;\n            break;\n\n          // flip vertical\n          case 4:\n            scaleY = -1;\n            break;\n\n          // flip vertical + rotate right 90°\n          case 5:\n            rotate = 90;\n            scaleY = -1;\n            break;\n\n          // rotate right 90°\n          case 6:\n            rotate = 90;\n            break;\n\n          // flip horizontal + rotate right 90°\n          case 7:\n            rotate = 90;\n            scaleX = -1;\n            break;\n\n          // rotate left 90°\n          case 8:\n            rotate = -90;\n            break;\n        }\n      }\n\n      if (options.rotatable) {\n        imageData.rotate = rotate;\n      }\n\n      if (options.scalable) {\n        imageData.scaleX = scaleX;\n        imageData.scaleY = scaleY;\n      }\n\n      self.clone();\n    }\n  }, {\n    key: 'clone',\n    value: function clone() {\n      var self = this;\n      var element = self.element;\n      var url = self.url;\n      var crossOrigin = void 0;\n      var crossOriginUrl = void 0;\n      var start = void 0;\n      var stop = void 0;\n\n      if (self.options.checkCrossOrigin && isCrossOriginURL(url)) {\n        crossOrigin = element.crossOrigin;\n\n        if (crossOrigin) {\n          crossOriginUrl = url;\n        } else {\n          crossOrigin = 'anonymous';\n\n          // Bust cache when there is not a \"crossOrigin\" property\n          crossOriginUrl = addTimestamp(url);\n        }\n      }\n\n      self.crossOrigin = crossOrigin;\n      self.crossOriginUrl = crossOriginUrl;\n\n      var image = createElement('img');\n\n      if (crossOrigin) {\n        image.crossOrigin = crossOrigin;\n      }\n\n      image.src = crossOriginUrl || url;\n      self.image = image;\n      self.onStart = start = proxy(self.start, self);\n      self.onStop = stop = proxy(self.stop, self);\n\n      if (self.isImg) {\n        if (element.complete) {\n          self.start();\n        } else {\n          addListener(element, EVENT_LOAD, start);\n        }\n      } else {\n        addListener(image, EVENT_LOAD, start);\n        addListener(image, EVENT_ERROR, stop);\n        addClass(image, 'cropper-hide');\n        element.parentNode.insertBefore(image, element.nextSibling);\n      }\n    }\n  }, {\n    key: 'start',\n    value: function start(event) {\n      var self = this;\n      var image = self.isImg ? self.element : self.image;\n\n      if (event) {\n        removeListener(image, EVENT_LOAD, self.onStart);\n        removeListener(image, EVENT_ERROR, self.onStop);\n      }\n\n      getImageSize(image, function (naturalWidth, naturalHeight) {\n        extend(self.imageData, {\n          naturalWidth: naturalWidth,\n          naturalHeight: naturalHeight,\n          aspectRatio: naturalWidth / naturalHeight\n        });\n\n        self.loaded = true;\n        self.build();\n      });\n    }\n  }, {\n    key: 'stop',\n    value: function stop() {\n      var self = this;\n      var image = self.image;\n\n      removeListener(image, EVENT_LOAD, self.onStart);\n      removeListener(image, EVENT_ERROR, self.onStop);\n\n      removeChild(image);\n      self.image = null;\n    }\n  }, {\n    key: 'build',\n    value: function build() {\n      var self = this;\n      var options = self.options;\n      var element = self.element;\n      var image = self.image;\n      var container = void 0;\n      var cropper = void 0;\n      var canvas = void 0;\n      var dragBox = void 0;\n      var cropBox = void 0;\n      var face = void 0;\n\n      if (!self.loaded) {\n        return;\n      }\n\n      // Unbuild first when replace\n      if (self.ready) {\n        self.unbuild();\n      }\n\n      var template = createElement('div');\n      template.innerHTML = TEMPLATE;\n\n      // Create cropper elements\n      self.container = container = element.parentNode;\n      self.cropper = cropper = getByClass(template, 'cropper-container')[0];\n      self.canvas = canvas = getByClass(cropper, 'cropper-canvas')[0];\n      self.dragBox = dragBox = getByClass(cropper, 'cropper-drag-box')[0];\n      self.cropBox = cropBox = getByClass(cropper, 'cropper-crop-box')[0];\n      self.viewBox = getByClass(cropper, 'cropper-view-box')[0];\n      self.face = face = getByClass(cropBox, 'cropper-face')[0];\n\n      appendChild(canvas, image);\n\n      // Hide the original image\n      addClass(element, CLASS_HIDDEN);\n\n      // Inserts the cropper after to the current image\n      container.insertBefore(cropper, element.nextSibling);\n\n      // Show the image if is hidden\n      if (!self.isImg) {\n        removeClass(image, 'cropper-hide');\n      }\n\n      self.initPreview();\n      self.bind();\n\n      options.aspectRatio = Math.max(0, options.aspectRatio) || NaN;\n      options.viewMode = Math.max(0, Math.min(3, Math.round(options.viewMode))) || 0;\n\n      self.cropped = options.autoCrop;\n\n      if (options.autoCrop) {\n        if (options.modal) {\n          addClass(dragBox, 'cropper-modal');\n        }\n      } else {\n        addClass(cropBox, CLASS_HIDDEN);\n      }\n\n      if (!options.guides) {\n        addClass(getByClass(cropBox, 'cropper-dashed'), CLASS_HIDDEN);\n      }\n\n      if (!options.center) {\n        addClass(getByClass(cropBox, 'cropper-center'), CLASS_HIDDEN);\n      }\n\n      if (options.background) {\n        addClass(cropper, 'cropper-bg');\n      }\n\n      if (!options.highlight) {\n        addClass(face, 'cropper-invisible');\n      }\n\n      if (options.cropBoxMovable) {\n        addClass(face, 'cropper-move');\n        setData$1(face, 'action', 'all');\n      }\n\n      if (!options.cropBoxResizable) {\n        addClass(getByClass(cropBox, 'cropper-line'), CLASS_HIDDEN);\n        addClass(getByClass(cropBox, 'cropper-point'), CLASS_HIDDEN);\n      }\n\n      self.setDragMode(options.dragMode);\n      self.render();\n      self.ready = true;\n      self.setData(options.data);\n\n      // Call the \"ready\" option asynchronously to keep \"image.cropper\" is defined\n      self.completing = setTimeout(function () {\n        if (isFunction(options.ready)) {\n          addListener(element, EVENT_READY, options.ready, true);\n        }\n\n        dispatchEvent(element, EVENT_READY);\n        dispatchEvent(element, EVENT_CROP, self.getData());\n\n        self.complete = true;\n      }, 0);\n    }\n  }, {\n    key: 'unbuild',\n    value: function unbuild() {\n      var self = this;\n\n      if (!self.ready) {\n        return;\n      }\n\n      if (!self.complete) {\n        clearTimeout(self.completing);\n      }\n\n      self.ready = false;\n      self.complete = false;\n      self.initialImageData = null;\n\n      // Clear `initialCanvasData` is necessary when replace\n      self.initialCanvasData = null;\n      self.initialCropBoxData = null;\n      self.containerData = null;\n      self.canvasData = null;\n\n      // Clear `cropBoxData` is necessary when replace\n      self.cropBoxData = null;\n      self.unbind();\n\n      self.resetPreview();\n      self.previews = null;\n\n      self.viewBox = null;\n      self.cropBox = null;\n      self.dragBox = null;\n      self.canvas = null;\n      self.container = null;\n\n      removeChild(self.cropper);\n      self.cropper = null;\n    }\n  }], [{\n    key: 'noConflict',\n    value: function noConflict() {\n      window.Cropper = AnotherCropper;\n      return Cropper;\n    }\n  }, {\n    key: 'setDefaults',\n    value: function setDefaults(options) {\n      extend(DEFAULTS, isPlainObject(options) && options);\n    }\n  }]);\n  return Cropper;\n}();\n\nextend(Cropper.prototype, render$1);\nextend(Cropper.prototype, preview$1);\nextend(Cropper.prototype, events);\nextend(Cropper.prototype, handlers);\nextend(Cropper.prototype, change$1);\nextend(Cropper.prototype, methods);\n\nif (typeof window !== 'undefined') {\n  AnotherCropper = window.Cropper;\n  window.Cropper = Cropper;\n}\n\nreturn Cropper;\n\n})));\n"]}